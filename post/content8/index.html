<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Airflowã®Pluginsã«ã¤ã„ã¦ | -1.9517320122461623</title><meta name=keywords content="Airflow,Python"><meta name=description content="ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ©Ÿèƒ½ã«ã¤ã„ã¦ã§ã™"><meta name=author content="Me"><link rel=canonical href=https://canonical.url/to/page><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.447f4924d3ebf89bcf25c7e77c905cb2ee6ea803dacb2c3621646ef4f50d1f86.css integrity="sha256-RH9JJNPr+JvPJcfnfJBcsu5uqAPayyw2IWRu9PUNH4Y=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://github.com/srn221B/srn221B.github.io/assets/60976262/00ebf8b5-eceb-4f87-8e70-df54f431a9b8><link rel=icon type=image/png sizes=16x16 href=https://github.com/srn221B/srn221B.github.io/assets/60976262/00ebf8b5-eceb-4f87-8e70-df54f431a9b8><link rel=icon type=image/png sizes=32x32 href=https://github.com/srn221B/srn221B.github.io/assets/60976262/00ebf8b5-eceb-4f87-8e70-df54f431a9b8><link rel=apple-touch-icon href=https://user-images.githubusercontent.com/60976262/190914441-404cb19b-540f-4178-a89d-8f89ab1e187c.png><link rel=mask-icon href=https://user-images.githubusercontent.com/60976262/190914441-404cb19b-540f-4178-a89d-8f89ab1e187c.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Airflowã®Pluginsã«ã¤ã„ã¦"><meta property="og:description" content="ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ©Ÿèƒ½ã«ã¤ã„ã¦ã§ã™"><meta property="og:type" content="article"><meta property="og:url" content="https://467tn.com/post/content8/"><meta property="og:image" content="https://user-images.githubusercontent.com/60976262/191047722-dd7ed9ad-6e00-4b50-8073-24ae9602b8d6.png"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-01-04T11:30:03+00:00"><meta property="article:modified_time" content="2023-01-04T11:30:03+00:00"><meta property="og:site_name" content="467"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://user-images.githubusercontent.com/60976262/191047722-dd7ed9ad-6e00-4b50-8073-24ae9602b8d6.png"><meta name=twitter:title content="Airflowã®Pluginsã«ã¤ã„ã¦"><meta name=twitter:description content="ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ©Ÿèƒ½ã«ã¤ã„ã¦ã§ã™"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://467tn.com/post/"},{"@type":"ListItem","position":3,"name":"Airflowã®Pluginsã«ã¤ã„ã¦","item":"https://467tn.com/post/content8/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Airflowã®Pluginsã«ã¤ã„ã¦","name":"Airflowã®Pluginsã«ã¤ã„ã¦","description":"ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ©Ÿèƒ½ã«ã¤ã„ã¦ã§ã™","keywords":["Airflow","Python"],"articleBody":"AirflowPluginsã¨ã¯ Airflowã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹ãŸã‚ã«è¿½åŠ ã§ãã‚‹Pluginã€‚\nã©ã‚“ãªæ™‚ã«AirflowPluginsã‚’ä½¿ã†ã®ã‹ ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ãªã¨ãã«AirflowPluginsã‚’ä½¿ã†ã€‚\n Airflowã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®DBã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤ºã™ã‚‹Viewã‚’ä½œæˆã—ãŸã„ã¨ãã€‚ æŒ‡å®šã•ã‚ŒãŸæ™‚é–“å†…ã«ãŠã„ã¦ä»»æ„æ•°ã®DAGãŒå¤±æ•—æ™‚ã«Airflowã®æ©Ÿèƒ½ã‚’ç›£è¦–ã—ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆã‚’é€ä¿¡ã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ãŸã„ã¨ãã€‚ å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ãƒ„ãƒ¼ãƒ«ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ãƒ­ã‚°ã«å‹•çš„ã«ãƒªãƒ³ã‚¯ã™ã‚‹è©³ç´°ãƒ“ãƒ¥ãƒ¼ã‚’UIã«è¡¨ç¤ºã—ãŸã„ã¨ãã€‚  æ–°è¦Pluginä½œæˆæ–¹æ³• ã€Œplugins_folderã€ã¸Pythonãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã—ã€Pythonãƒ•ã‚¡ã‚¤ãƒ«å†…ã§airflow.plugins_manager.AirflowPluginã‚’æ‹¡å¼µã™ã‚‹ã‚¯ãƒ©ã‚¹ã‚’å®šç¾©ã™ã‚Œã°æ–°è¦Pluginã‚’ä½œæˆã§ãã‚‹ã€‚\n Pythonãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾‹  å®šç¾©ã—ãŸAirflowPluginã‚¯ãƒ©ã‚¹ã«ã¯ä»¥ä¸‹ã‚’å®Ÿè£…ã™ã‚‹ã€‚  name:propertyã«Pluginå on_load:functionã«Pluginã®ãƒ­ãƒ¼ãƒ‰æ™‚ã«å®Ÿè¡Œã—ã¦ã»ã—ã„å‡¦ç† ãã®ã»ã‹Pluginã«è¿½åŠ ã—ãŸã„Component(Pluginã®æ©Ÿèƒ½)ã«ã¤ã„ã¦åˆ—æŒ™      from airflow.plugins_manager import AirflowPlugin class MyAirflowPlugin(AirflowPlugin): name = \"empty\" def on_load(cls, *args, **kwargs): pass # ãã®ã»ã‹Pluginã«è¿½åŠ ã—ãŸã„Componentã«ã¤ã„ã¦åˆ—æŒ™ã—ã¦ã„ãã€‚ ä¸Šè¨˜å ´åˆã€PluginåãŒã€Œemptyã€ã§ã‚ã‚‹Pluginã‚’ä½œæˆã—ã¦ã„ã‚‹ã€‚\n ã€Œplugins_folderã€ã®ç¢ºèªã®ä»•æ–¹  ã¡ãªã¿ã«ã€Œplugins_folderã€ã¯ã©ã“ã§ç¢ºèªã§ãã‚‹ã®ã‹ã¨ã„ã†ã®ã ãŒã€ã€Œã‚³ãƒãƒ³ãƒ‰ã‚’åˆ©ç”¨ã™ã‚‹ã€ã‹ã€Œcfgãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¦‹ã‚‹ã€ã®2é€šã‚Šã§ç¢ºèªã§ãã‚‹ã€‚ åŸºæœ¬çš„ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯$AIRFLOW_HOME/pluginsã«ãªã£ã¦ã„ã‚‹ã¯ãšã€‚    # ã‚³ãƒãƒ³ãƒ‰ã‚’åˆ©ç”¨ã™ã‚‹ $ airflow info | grep plugins_folder plugins_folder | xxx # cfgãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¦‹ã‚‹ $ cat airflow.cfg | grep plugins_folder plugins_folder = xxxx Pluginç¢ºèªæ–¹æ³• ç¾åœ¨è¿½åŠ ã•ã‚Œã¦ã„ã‚‹Pluginã¯ä½•ã‹ã€Pluginã«å®šç¾©ã•ã‚Œã¦ã‚ã‚‹Componentã¯ä½•ã‹ã‚’ç¢ºèªã™ã‚‹æ–¹æ³•ã ãŒã€ã€ŒUIã‹ã‚‰ç¢ºèªã™ã‚‹æ–¹æ³•ã€ã¨ã€ŒCLIã‚’åˆ©ç”¨ã—ã¦ç¢ºèªã™ã‚‹æ–¹æ³•ã€ãŒã‚ã‚‹ã€‚WebServerã‚’å†èµ·å‹•ã—ãªãã¦ã‚‚ã™ãã«åæ˜ ã•ã‚Œã‚‹ã®ã¯å¾Œè€…ã®æ–¹æ³•ã€‚\n ã€ŒUIã‹ã‚‰ç¢ºèªã™ã‚‹æ–¹æ³•ã€  UIã®Admin-Pluginsã‚’ä½¿ç”¨ã™ã‚‹ã€‚     ã€ŒCLIã‚’åˆ©ç”¨ã—ã¦ç¢ºèªã™ã‚‹æ–¹æ³•ã€  airflow pluginsã‚’å®Ÿè¡Œã™ã‚‹ã€‚    $ airflow plugins name | source | appbuilder_views | macros ================+=============================+=============================================================================================+====================== my_plugins_poyo | $PLUGINS_FOLDER/__init__.py | {'name': 'Test View', 'category': 'Test Plugin', 'view': '__init__.TestAppBuilderBaseView'} | __init__.plugin_macro ã©ã‚“ãªComponentã‚’Pluginã«è¿½åŠ ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã®ã‹ ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ãªComponentãŒç¾åœ¨ã‚ã‚‹ã€‚ç¨®é¡ã¨ã—ã¦UIã¸ã®æ©Ÿèƒ½è¿½åŠ ã‹ã‚‰Schedulingã€DAGä½œæˆã™ã‚‹ä¸Šã§ã®æ©Ÿèƒ½è¿½åŠ ãªã©ãªã©ãŒã‚ã‚‹ã€‚è©³ç´°ã«ã¤ã„ã¦ã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç¢ºèªã™ã‚‹ã¨è‰¯ã„ã€‚\n   No Component About     1 hooks ç‹¬è‡ªã®Hookã‚’ä½œæˆã™ã‚‹   2 macros ã‚«ã‚¹ã‚¿ãƒ macroã‚’ä½œæˆã™ã‚‹   3 flask_blueprints Airflowã®Flaskã«flask.BluePrintè£½ã®ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹   4 appbuilder_views Airflowã®Flaskã«flask_appbuilder.BaseViewè£½ã®ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹   5 appbuilder_menu_items Airflow UIã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¨ãƒªãƒ³ã‚¯ã‚’ä½œæˆã™ã‚‹   6 global_operator_extra_links å…¨ã¦ã®ç¨®é¡ã®Operatorã«Linkã‚’ä½œæˆã™ã‚‹   7 operator_extra_links ä»»æ„ã®ç¨®é¡ã®Operatorã«Linkã‚’ä½œæˆã™ã‚‹   8 timetables CRONã§ã¯è¡¨ç¾ã§ããªã„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½œæˆã™ã‚‹    ãã®ã»ã‹ã€Œexecutorã‚’ä½¿ç”¨ã—ã¦CustomExecutorã‚’ä½œæˆã™ã‚‹ã€ã€Œlistenerã‚’ä½¿ç”¨ã—ã¦ã‚¤ãƒ™ãƒ³ãƒˆæ¤œçŸ¥ã‚’ä½œæˆã™ã‚‹ã€ãªã©ã§ããã†ã€‚\nä»Šå›ã¯ä¸Šè¨˜ã®Componentã®ã¿é †ã«è©¦ã—ã¦ã¿ã¾ã™ã€‚\n 1.hooksã‚’ä½¿ç”¨ã—ã¦ç‹¬è‡ªã®Hookã‚’ä½œæˆã™ã‚‹ã€‚ Airflowã®Hookã¨ã¯ å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ ã¨ã®ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã®å½¹å‰²ã‚’ã—ã¦ãã‚Œã‚‹ã‚ˆã†ãªã‚‚ã®ã€‚ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ã„ã¦ä¸€è²«ã—ãŸãƒ¡ã‚½ãƒƒãƒ‰ã‚’æä¾›ã™ã‚‹ã“ã¨ã‚’æ„å›³ã¨ã—ã¦ã‚ã‚‹ã€‚\npg_hook = PostgresHook.get_hook(conn_id) pg_hook.copy_exper() è©³ç´°ï¼šhttps://airflow.apache.org/docs/apache-airflow/stable/concepts/connections.html\nplugins_folderé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ« ä»Šå›ã¯æ¬¡ã®ã‚ˆã†ãªãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ ã§æ–°è¦ç‹¬è‡ªã®Hookã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚\n. â”œâ”€â”€ __init__.pyã€€# pluginã«ã¤ã„ã¦å®šç¾© â”œâ”€â”€ hooks â”‚Â â”œâ”€â”€ __init__.py â”‚Â â””â”€â”€ airflow_hook_template.py # Hookã«ã¤ã„ã¦å®šç¾©  __init__.py  from __future__ import division, absolute_import, print_function import hooks from airflow.plugins_manager import AirflowPlugin class MyPlugins(AirflowPlugin): name = \"my_plugins_poyo\" hooks = [hooks.PluginHook]  hooks/__init__.py  from hooks.airflow_hook_template import PluginHook __all__ = ['PluginHook']  hooks/airflow_hook_template.py  airflow.hooks.base.BaseHookã‚’æ‹¡å¼µã—ã¦æ›¸ãã€‚    from airflow.hooks.base import BaseHook class PluginHook(BaseHook): pass ä¸Šè¨˜ã®å ´åˆã€ç‰¹ã«ä½•ã‚‚ã—ãªã„Hookã€‚\nä½œæˆã‚’åæ˜ ã•ã›ã‚‹ã€‚ webserverã®å†èµ·å‹•ãŒå¿…è¦ã€‚\ndagã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰importã—ã¦ã¿ã‚‹ plugins_folderã¯ç’°å¢ƒå¤‰æ•°PYTHONPATHã¨ã—ã¦è‡ªå‹•çš„ã«buildã•ã‚Œã¦ã„ã‚‹(https://airflow.apache.org/docs/apache-airflow/stable/modules_management.html#built-in-pythonpath-entries-in-airflow)ã®ã§,ç›´æ¥plugins_folderé…ä¸‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®šã™ã‚‹å½¢ã§importã§ãã‚‹ã€‚UIã‹ã‚‰DAGã‚’ç¢ºèªã™ã‚‹ãªã©ã‚’ã—ã¦importErrorãŒå‡ºã¦ã„ãªã‘ã‚Œã°æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹ã€‚\n dagã®ãƒ•ã‚¡ã‚¤ãƒ«  from hooks.airflow_hook_template import PluginHook  2.macrosã‚’ä½¿ç”¨ã—ã¦ã‚«ã‚¹ã‚¿ãƒ macroã‚’ä½œæˆã™ã‚‹ã€‚ macroã¨ã¯ JinjaTemplateã‚’ä½¿ç”¨ã—ã¦Taskå†…ã§åˆ©ç”¨ã§ãã‚‹å¤‰æ•°ã®ã‚ˆã†ãªã‚‚ã®ã€‚\nprint('å®Ÿè¡Œæ—¥ã¯ {{execution_date}}') è©³ç´°ï¼šhttps://airflow.apache.org/docs/apache-airflow/stable/templates-ref.html\nplugins_folderé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ« plugins_folderé…ä¸‹ã«__init__.pyã‚’ä½œæˆã—ã¦ãã“ã«è¨˜è¼‰ã™ã‚‹å½¢ã§æ›¸ã„ã¦ã„ãã€‚\n __init__.py  é–¢æ•°ã«ä½œæˆã™ã‚‹macroã«ã¤ã„ã¦å®šç¾©ã—ã¦ã„ãã€‚  é–¢æ•°åãŒmacroå é–¢æ•°ã®æˆ»ã‚Šå€¤ãŒmacroã®valueã¨ãªã‚‹      from airflow.plugins_manager import AirflowPlugin def plugin_macro(x: int): return x + 1 class MyPlugins(AirflowPlugin): name = \"my_plugins_poyo\" macros = [plugin_macro] ä¸Šè¨˜ã®å ´åˆã€plugin_macroã¨ã„ã†macroã‚’å®šç¾©ã—ã¦ãŠã‚Šã€ãã®macroã¯å¼•æ•°x:intã‚’x + 1ã—ãŸå½¢ã§è¿”ã™ã¨ã„ã†ã“ã¨ã‚’ã—ã¦ã„ã‚‹ã€‚\nä½œæˆã‚’åæ˜ ã•ã›ã‚‹ã€‚ webserverã®å†èµ·å‹•ãŒå¿…è¦ã€‚\ndagã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰åˆ©ç”¨ã—ã¦ã¿ã‚‹  dagã®ãƒ•ã‚¡ã‚¤ãƒ«  ä½œæˆã—ãŸmacroã¯macros..ã§å–å¾—ã§ãã‚‹ã€‚    from airflow.decorators import task, dag from airflow.utils.dates import days_ago @task def test_output(**kwargs): macros = kwargs['macros'] input = 1 print(f'input: {input}') print(f'output: {macros.my_plugins_poyo.plugin_macro(input)}') @dag(start_date=days_ago(2)) def test_plugins(): test_output() test_plugins()  log  ä¸Šè¨˜DAGã‚’å®Ÿè¡Œã—ã¦ã¿ãŸLogã ãŒã€å¼•æ•°1ã«å¯¾ã—outputãŒ2ã¨ãªã£ã¦ã„ã‚‹ã®ã§macroãŒåŠ¹ã„ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã‚‹ã€‚    [2023-01-04, 18:31:16 JST] {logging_mixin.py:137} INFO - input: 1 [2023-01-04, 18:31:16 JST] {logging_mixin.py:137} INFO - output: 2  3.flask_blueprintsã‚’ä½¿ç”¨ã—ã¦Airflowã®Flaskã«flask.BluePrintè£½ã®ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹ã€‚ flask.BluePrintã¨ã¯ Flaskå†…ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æ©Ÿèƒ½ã‚’è¤‡æ•°ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ†å‰²ã™ã‚‹æ–¹æ³•ã€‚ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒé•·ã™ãã‚‹å ´åˆã«ã€æ©Ÿèƒ½ã”ã¨ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†å‰²ã—ç®¡ç†ã—ã‚„ã™ãã™ã‚‹ãŸã‚ã«åˆ©ç”¨ã™ã‚‹ã€‚\nplugins_folderé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ« plugins_folderé…ä¸‹ã«__init__.pyã‚’ä½œæˆã—ã¦ãã“ã«è¨˜è¼‰ã™ã‚‹å½¢ã§æ›¸ã„ã¦ã„ãã€‚\n __init__.py  airflow.plugins_manager.AirflowPluginã‚’æ‹¡å¼µã—ã¦ã‹ãã€‚ @bp.routeã«æ¸¡ã—ãŸãƒ‘ã‚¹ãŒè¿½åŠ ã—ãŸã„ãƒšãƒ¼ã‚¸ã®http://:/ç›´ä¸‹ã®Subpathã¨ãªã‚‹ã€‚    from flask import Blueprint from airflow.plugins_manager import AirflowPlugin bp = Blueprint('app2', __name__) @bp.route('/bp_test') def bp_test(): \"\"\" ä»Šæ—¥ã®å¤©æ°—ã‚’å–å¾—ã—ã¦è¡¨ç¤ºã™ã‚‹ \"\"\" import requests import json res = requests.get('https://weather.tsukumijima.net/api/forecast/city/220030') today_weather = json.loads(res.text)['forecasts'][0] return today_weather['date'] + ' ' + today_weather['detail']['weather'] class MyPlugins(AirflowPlugin): name = \"my_plugins_poyo\" flask_blueprints = [bp] ä¸Šè¨˜ã®å ´åˆã€SubpathãŒ/bp_testã§ã‚ã‚‹ãƒšãƒ¼ã‚¸ã‚’è¿½åŠ ã—ã¦ãŠã‚Šã€ãƒšãƒ¼ã‚¸ã‚’é–‹ãã¨weatherAPIã‚’ä½¿ç”¨ã—ã¦ä»»æ„ã®å¸‚ã®ä»Šæ—¥ã®æ—¥ä»˜ã¨å¤©æ°—ã‚’å–å¾—ã—è¡¨ç¤ºã™ã‚‹ã‚ˆã†ãªã“ã¨ã‚’ã—ã¦ã„ã‚‹ã€‚\nä½œæˆã‚’åæ˜ ã•ã›ã‚‹ã€‚ webserverã®å†èµ·å‹•ãŒå¿…è¦ã€‚\nä½œæˆã—ãŸãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã‚‹ã€‚  http://:/bp_testã¸ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã€‚   4.appbuilder_viewsã‚’ä½¿ç”¨ã—ã¦Airflowã®Flaskã«flask_appbuilder.BaseViewè£½ã®ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹ã€‚ flask_appbuilder.BaseViewã¨ã¯ Flaskã®Viewã®ã†ã¡ã€ã‚ˆã‚Šãã‚ç´°ã‹ãã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£(ãƒ¡ã‚½ãƒƒãƒ‰,ã‚¢ã‚¯ã‚»ã‚¹)ã‚’è¨­å®šã§ãã‚‹Viewã€‚\nplugins_folderé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ« plugins_folderé…ä¸‹ã«__init__.pyã‚’ä½œæˆã—ã¦ãã“ã«è¨˜è¼‰ã™ã‚‹å½¢ã§æ›¸ã„ã¦ã„ãã€‚\n __init__.py  Airflowã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«Viewã®Linkã‚’è¨­å®šã™ã‚‹å½¢ã§æ›¸ã„ã¦ã„ãã€‚  category:strã«æ¸¡ã—ãŸå€¤ãŒãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼å name:strã«æ¸¡ã—ãŸå€¤ãŒã‚»ã‚¯ã‚·ãƒ§ãƒ³å      from airflow.plugins_manager import AirflowPlugin from flask_appbuilder import expose, BaseView as AppBuilderBaseView class TestAppBuilderBaseView(AppBuilderBaseView): default_view = \"test\" @expose('/') def test(self): \"\"\" hello test_pageã‚’è¡¨ç¤ºã™ã‚‹ \"\"\" return 'hello test_page' v_appbuilder_view = TestAppBuilderBaseView() v_appbuilder_package = { \"name\": \"Test View\", \"category\": \"Test Plugin\", \"view\": v_appbuilder_view, } class MyPlugins(AirflowPlugin): name = \"my_plugins_poyo\" appbuilder_views = [v_appbuilder_package] ä¸Šè¨˜ã®å ´åˆã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼åTest Pluginã‚»ã‚¯ã‚·ãƒ§ãƒ³åTest Viewã«Viewã¸ã®Linkã‚’è¨­å®šã—ã¦ãŠã‚Šã€Linkã‚’ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨â€™hello test_pageâ€™ã¨è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’æœŸå¾…ã—ã¦ã„ã‚‹ã€‚\nä½œæˆã‚’åæ˜ ã•ã›ã‚‹ã€‚ webserverã®å†èµ·å‹•ãŒå¿…è¦ã€‚\nä½œæˆã—ãŸãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã‚‹ã€‚  æœŸå¾…é€šã‚Šã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒã§ãã¦ã„ã‚‹ã€‚   Viewã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã‚‹ã¨ãƒšãƒ¼ã‚¸ãŒæ­£å¸¸ã«ç¢ºèªã§ãã‚‹ã€‚   5.appbuilder_menu_itemsã‚’ã—ã¦Airflow UIã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¨ãƒªãƒ³ã‚¯ã‚’ä½œæˆã™ã‚‹ã€‚ plugins_folderé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ« plugins_folderé…ä¸‹ã«__init__.pyã‚’ä½œæˆã—ã¦ãã“ã«è¨˜è¼‰ã™ã‚‹å½¢ã§æ›¸ã„ã¦ã„ãã€‚\n __init__.py  4.appbuilder_viewsã®èª¬æ˜ã¨åŒæ§˜  category:strã«æ¸¡ã—ãŸå€¤ãŒãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼å name:strã«æ¸¡ã—ãŸå€¤ãŒã‚»ã‚¯ã‚·ãƒ§ãƒ³å      from airflow.plugins_manager import AirflowPlugin appbuilder_mitem = { \"name\": \"467 notes\", \"href\": \"https://467tn.com\", \"category\": \"MyPages\", } class MyPlugins(AirflowPlugin): name = \"my_plugins_poyo\" appbuilder_menu_items = [appbuilder_mitem] ä¸Šè¨˜ã®å ´åˆã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼åMyPagesã‚»ã‚¯ã‚·ãƒ§ãƒ³å467 notesã«Viewã¸ã®Linkã‚’è¨­å®šã—ã¦ãŠã‚Šã€Linkã‚’ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨hrefå…ˆã®ãƒšãƒ¼ã‚¸ã¸é·ç§»ã•ã‚Œã‚‹ã“ã¨ã‚’æœŸå¾…ã—ã¦ã„ã‚‹ã€‚\nä½œæˆã‚’åæ˜ ã•ã›ã‚‹ã€‚ webserverã®å†èµ·å‹•ãŒå¿…è¦ã€‚\nä½œæˆã—ãŸãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã‚‹ã€‚  æœŸå¾…é€šã‚Šã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒã§ãã¦ã„ã‚‹ã€‚ã¾ãŸã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³å…ˆã‚’ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨https://467tn.comã¸é·ç§»ã•ã‚Œã‚‹ã€‚   6.global_operator_extra_linksã‚’ä½¿ç”¨ã—ã¦å…¨ã¦ã®ç¨®é¡ã®Operatorã«Linkã‚’ä½œæˆã™ã‚‹ Airflowã®OperatorLinkã¨ã¯ Taskã®è©³ç´°ç”»é¢ã«ã¤ã‘ã‚‹ãƒœã‚¿ãƒ³Link(ã†ã¾ã„è¡¨ç¾ãŒã‚ã‹ã‚Šã¾ã›ã‚“)ã€‚åŸºåº•ãŒBaseOperatorLinkã¨ãªã£ã¦ãŠã‚Šã€ãƒœã‚¿ãƒ³Linkã‚’Clickã™ã‚‹ã¨å½“ã‚¯ãƒ©ã‚¹ã®get_link:functionãŒå®Ÿè¡Œã•ã‚Œã‚‹ã‚ã‘ã ãŒã€get_link:functionã«ã¯å¼•æ•°ã¨ã—ã¦å½“Taskã®operator(BaseOperator)ã¨ti_key(airflow.models.taskinstance.TaskInstanceKey)ãŒæ¸¡ã•ã‚Œã‚‹ã€‚ãªã®ã§ã“ã®OperatorLinkã‚’ä½¿ãˆã°ã€OperatorãŒå¤–éƒ¨ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã¨é€šä¿¡ã™ã‚‹ã‚ˆã†ãªOperatorã ã£ãŸå ´åˆã«å¤–éƒ¨ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹å…ˆã«ã‚ã‚‹Logãªã©ã‚’ti_keyã‚’ã‚‚ã¨ã«è¡¨ç¤ºã™ã‚‹ã‚ˆã†ãªã“ã¨ãŒã§ãã¾ã™ã€‚ ä¾‹ãˆã°æ¨™æº–ã§provideã•ã‚Œã¦ã„ã‚‹OperatorLinkã®ã†ã¡ã€BigQueryConsoleLinkã¯ã€BigQueryOperatorã‚’ä½¿ç”¨ã—ã¦BigQueryã«æŠ•ã’ãŸLogã‚’GoogleCloudConsoleã‹ã‚‰å½“job_idã‚’æŒ‡å®šã—ã¦ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ãªä»•æ§˜ã‚’ã—ã¦ã„ã‚‹OperatorLinkã§ã™ã€‚\nè©³ç´°ï¼šhttps://airflow.apache.org/docs/apache-airflow/stable/howto/define_extra_link.html\nplugins_folderé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ« plugins_folderé…ä¸‹ã«__init__.pyã‚’ä½œæˆã—ã¦ãã“ã«è¨˜è¼‰ã™ã‚‹å½¢ã§æ›¸ã„ã¦ã„ãã€‚\n __init__.py  BaseOperatorLinkã‚’æ‹¡å¼µã—ã¦æ›¸ãã€‚  name:propertyã«æ¸¡ã—ãŸå€¤ãŒãƒœã‚¿ãƒ³Linkå get_link:functionã«å®šç¾©ã—ãŸå‡¦ç†ã¯ãƒœã‚¿ãƒ³Linkã‚’Clickã—ãŸæ™‚ã«å‹•ä½œã™ã‚‹æŒ™å‹•ã€‚  æˆ»ã‚Šå€¤ã¨ã—ã¦strã§LinkPathã‚’è¨˜è¼‰ã€‚        from airflow.plugins_manager import AirflowPlugin from airflow.models.baseoperator import BaseOperatorLink class GlobalLink(BaseOperatorLink): name = \"Airflow docs\" def get_link(self, operator, *, ti_key=None): return \"https://airflow.apache.org/\" class MyPlugins(AirflowPlugin): name = \"my_plugins_poyo\" global_operator_extra_links = [ GlobalLink(), ] ä¸Šè¨˜ã®å ´åˆã€Airflow docsã¨ã„ã†ãƒœã‚¿ãƒ³Linkã‚’ä½œæˆã—ã¦ãŠã‚Šã€ãƒœã‚¿ãƒ³Linkã‚’Clickã™ã‚‹ã¨https://airflow.apache.org/ã¸é·ç§»ã™ã‚‹ã€‚\nä½œæˆã‚’åæ˜ ã•ã›ã‚‹ã€‚ webserverã®å†èµ·å‹•ãŒå¿…è¦ã€‚\nä½œæˆã—ãŸLinkã‚’ç¢ºèªã—ã¦ã¿ã‚‹ã€‚  ä»»æ„ã®Taskã®è©³ç´°ã‚’é–‹ãã¨Operatorã®ç¨®é¡ã«é™ã‚‰ãšæœŸå¾…é€šã‚Šã®ãƒœã‚¿ãƒ³LinkãŒä½œã‚‰ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã‚‹ã€‚ãƒœã‚¿ãƒ³Linkã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨https://airflow.apache.org/ã¸é·ç§»ã™ã‚‹ã€‚   7.operator_extra_linksã‚’ä½¿ç”¨ã—ã¦ä»»æ„ã®ç¨®é¡ã®Operatorã«Linkã‚’ä½œæˆã™ã‚‹ã€‚ OperatorLinkã¨ã¯ ã€Œ6.global_operator_extra_linksã€ã§ã®èª¬æ˜ã¨åŒæ§˜ãªã®ã§å‰²æ„›ã€‚\nplugins_folderé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ« plugins_folderé…ä¸‹ã«__init__.pyã‚’ä½œæˆã—ã¦ãã“ã«è¨˜è¼‰ã™ã‚‹å½¢ã§æ›¸ã„ã¦ã„ãã€‚\n __init__.py  BaseOperatorLinkã‚’æ‹¡å¼µã—ã¦æ›¸ãã€‚  name:propertyã¨get_link:functionã®ä»•æ§˜ã«ã¤ã„ã¦ã¯ã€Œ6.global_operator_extra_linksã€ã§ã®èª¬æ˜ã¨åŒæ§˜ã€‚ operators:List[BaseOperator]ã«Linkã‚’åæ˜ ã—ãŸã„Operatorã‚’åˆ—æŒ™ã™ã‚‹ã€‚      from airflow.plugins_manager import AirflowPlugin from airflow.models.baseoperator import BaseOperatorLink from airflow.providers.cncf.kubernetes.operators.kubernetes_pod import ( KubernetesPodOperator, ) class MyLink(BaseOperatorLink): name = \"Kubernetes docs\" operators = [KubernetesPodOperator] def get_link(self, operator, *, ti_key=None): return \"https://kubernetes.io/\" class MyPlugins(AirflowPlugin): name = \"my_plugins_poyo\" operator_extra_links = [ MyLink(), ] ä¸Šè¨˜ã®å ´åˆã€Kubernetes docsã¨ã„ã†ãƒœã‚¿ãƒ³Linkã‚’ä½œæˆã—ã¦ãŠã‚Šã€ãƒœã‚¿ãƒ³Linkã‚’Clickã™ã‚‹ã¨https://kubernetes.io/ã¸é·ç§»ã™ã‚‹ã€‚ã¾ãŸã“ã®Linkã¯KubernetesPodOperatorã‚’ä½¿ç”¨ã—ãŸTaskã«ã—ã‹åæ˜ ã•ã‚Œãªã„ã“ã¨ã‚’æ„å›³ã¨ã—ã¦ã„ã‚‹ã€‚\nä½œæˆã‚’åæ˜ ã•ã›ã‚‹ã€‚ webserverã®å†èµ·å‹•ãŒå¿…è¦ã€‚\nä½œæˆã—ãŸLinkã‚’ç¢ºèªã—ã¦ã¿ã‚‹ã€‚ KubernetesPodOperatorã®ã‚ã‚‹DAGã‚’é–‹ã„ã¦ç¢ºèªã—ã¦ã¿ã‚‹ã€‚\n KubernetesPodOperatorã®Taskã«æœŸå¾…é€šã‚Šã®ãƒœã‚¿ãƒ³LinkãŒä½œã‚‰ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã‚‹ã€‚ãƒœã‚¿ãƒ³Linkã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨https://kubernetes.io/ã¸é·ç§»ã™ã‚‹ã€‚   PythonOperatorã®Taskã«ã¯ãƒœã‚¿ãƒ³LinkãŒä½œã‚‰ã‚Œã¦ã„ãªã„ã€‚   8.timetablesã‚’ä½¿ç”¨ã—ã¦CRONã§ã¯è¡¨ç¾ã§ããªã„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½œæˆã™ã‚‹ å€‹äººçš„ãªæœ¬é¡Œã ã£ãŸã®ã§å°‘ã—ä»–ã‚ˆã‚Šã‚‚ä¸å¯§ã«æ›¸ãã€‚\nTimetableã¨ã¯ Airflowã®DAGå†…ã§ã®ã€ŒCronã§è¡¨ã™ã“ã¨ãŒã§ããªã„ã‚ˆã†ãªã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ã‚’æ±ºã‚ã‚‹ãŸã‚ã®TimeTableã€‚DAGã«æ¸¡ã™timetableå¼•æ•°ã§æŒ‡å®šã§ãã‚‹ã€‚\n ã€ŒCronã§è¡¨ã™ã“ã¨ãŒã§ããªã„ã‚ˆã†ãªã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ã¨ã¯  ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã€‚ å®Ÿè¡Œé–“éš”ãŒä¸è¦å‰‡  2022.12.31 10:00/2023.01.03 10:00ã®ã¿å®Ÿè¡Œã™ã‚‹ãªã©   æ¯æ—¥ç•°ãªã‚‹æ™‚é–“ã«å®Ÿè¡Œã™ã‚‹  æ°´æ›œæ—¥ã¯10:00ã€æœ¨æ›œæ—¥ã¯03:00ã«å®Ÿè¡Œã™ã‚‹ãªã©   ã‚°ãƒ¬ã‚´ãƒªã‚ªæš¦ã«å¾“ã‚ãªã„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«   æ¨™æº–ã§provideã•ã‚Œã¦ã„ã‚‹TimeTable  EventsTimetable CronTriggerTimetable    è©³ç´°ï¼šhttps://airflow.apache.org/docs/apache-airflow/stable/concepts/timetable.html\nç‹¬è‡ªã®Timetableä½œæˆæ–¹æ³•ã«ã¤ã„ã¦ Airflow2.2ã‹ã‚‰ç‹¬è‡ªã®TimeTableã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚airflow.timetables.base.Timetableã‚’æ‹¡å¼µã™ã‚Œã°è‰¯ã„ã®ã ãŒã€ä»¥ä¸‹ã®é–¢æ•°ã‚’å«ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚\n   é–¢æ•°å about     next_dagrun_info ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œæ™‚ã®ãƒ‡ãƒ¼ã‚¿é–“éš”ã‚’è¿”ã™   infer_manual_data_interval æ‰‹å‹•å®Ÿè¡Œæ™‚ã®ãƒ‡ãƒ¼ã‚¿é–“éš”ã§è¿”ã™    ç‹¬è‡ªã®Timetableã«æŒ‡å®šã™ã‚‹é–¢æ•°ã‚’ä½œæˆã™ã‚‹ã€‚ ä»Šå›ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªä»•æ§˜ã®TimeTableã‚’ä½œã£ã¦ã¿ã¾ã™ã€‚\n 1æ—¥ã«2å›,06:00(â‘ )ã¨16:30(â‘¡)ã«ã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œã™ã‚‹ã€‚å®Ÿè¡Œæ™‚ã«å–å¾—ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã®é–“éš”ã¯ä»¥ä¸‹ã€‚  06:00(â‘ )å®Ÿè¡Œæ™‚ãƒ»ãƒ»ãƒ»å‰æ—¥ã®16:30~å½“æ—¥ã®06:00 16:30(â‘¡)å®Ÿè¡Œæ™‚ãƒ»ãƒ»ãƒ»å½“æ—¥ã®06:00~å½“æ—¥ã®16:30    next_dagrun_infoé–¢æ•°  ãƒ‡ãƒ¼ã‚¿ã®é–“éš”ã‚’DagRunInfo(run_after:DateTime, data_interval:DataInterval)ã§è¿”ã™ parameterã«å…¥ã£ã¦ãã‚‹restriction:TimeRestrictionã¨ã¯DAGã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ãã‚‹æœŸé–“ã«é–¢ã™ã‚‹åˆ¶é™(earliest:DateTime,latest:DateTime,catchup:bool)ã‚’æŒã¤ã‚¯ãƒ©ã‚¹ã€‚  def next_dagrun_info(  self,  *,  last_automated_data_interval: Optional[DataInterval],  restriction: TimeRestriction, ) - Optional[DagRunInfo]:  if last_automated_data_interval is not None: # a  last_start = last_automated_data_interval.start  delta = timedelta(days=1)  if last_start.hour == 6: # b  next_start = last_start.set(hour=16, minute=30).replace(tzinfo=UTC)  next_end = (last_start+delta).replace(tzinfo=UTC)  else: # c  next_start = (last_start+delta).set(hour=6, minute=0).replace(tzinfo=UTC)  next_end = (last_start+delta).replace(tzinfo=UTC) ã€€else: # d  next_start = restriction.earliest  if next_start is None:  return None  if not restriction.catchup:  next_start = max(next_start, DateTime.combine(Date.today(), Time.min).replace(tzinfo=UTC))  next_start = next_start.set(hour=6, minute=0).replace(tzinfo=UTC)  next_end = next_start.set(hour=16, minute=30).replace(tzinfo=UTC)  if restriction.latest is not None and next_start  restriction.latest: # e  return None  return DagRunInfo.interval(start=next_start, end=next_end) é•·ã„è¡Œã«ãªã‚Šã¾ã—ãŸãŒè£œè¶³ã™ã‚‹ã¨ä»¥ä¸‹\n åˆå›å®Ÿè¡Œã§ã¯ãªã„å ´åˆ(a)  å‰å›å®Ÿè¡Œã®ãƒ‡ãƒ¼ã‚¿é–“éš”ã®StartãŒ06:00ã®å ´åˆ(b)  ä»Šå›ã®å®Ÿè¡Œã¯â‘ ã«è©²å½“ã™ã‚‹ next_startã¯å‰å›ã®å½“æ—¥ã®16:30 next_endã¯å‰å›ã®ç¿Œæ—¥ã®06:00   å‰å›å®Ÿè¡Œã®ãƒ‡ãƒ¼ã‚¿é–“éš”ã®StartãŒ16:30ã®å ´åˆ(c)  ä»Šå›ã®å®Ÿè¡Œã¯â‘¡ã«è©²å½“ã™ã‚‹ next_startã¯å‰å›ã®ç¿Œæ—¥ã®06:00 next_endã¯å‰å›ã®ç¿Œæ—¥ã®16:30     åˆå›å®Ÿè¡Œã®å ´åˆ(d)  DAGã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ãã‚‹æœŸé–“ã®ã†ã¡ã®æœ€æ—©ã„æ—¥ã‚’å®Ÿè¡Œæ—¥(next_start)ã¨ã—ã¦ï¼ˆcatchup=Falseã®å ´åˆã€ç¾åœ¨ã®æ—¥ä»˜ã‚’å®Ÿè¡Œæ—¥(next_start)ã¨ã™ã‚‹ï¼‰  next_startã¯å®Ÿè¡Œæ—¥ã®06:00 next_endã¯å®Ÿè¡Œæ—¥ã®16:30     ã¾ãŸã“ã®æ™‚DAGã®çµ‚äº†æ—¥(restriction.latest)ãŒã‚ã‚‹å ´åˆã€ãã®æ—¥ã‚’è¶Šã—ãŸnext_endã‚’å®Ÿè¡Œã—ãªã„ã“ã¨ã‚’æœŸå¾…ã—ã¦ã„ã‚‹ã€‚(e)  infer_manual_data_intervalé–¢æ•°  ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œæ™‚ã®ãƒ‡ãƒ¼ã‚¿ã®é–“éš”ã‚’DataInterval(start: DateTime, end:Datetime)ã§è¿”ã™ã€‚  def infer_manual_data_interval(self, run_after: DateTime) - DataInterval:  delta = timedelta(days=1)  # a  if run_after = run_after.set(hour=6, minute=0) and run_after  run_after.set(hour=16, minute=30):  start = (run_after-delta).set(hour=16, minute=30, second=0).replace(tzinfo=UTC)  end = run_after.set(hour=6, minute=0, second=0).replace(tzinfo=UTC)  # b  elif run_after = run_after.set(hour=16, minute=30) and run_after.hour  23:  start = run_after.set(hour=6, minute=0, second=0).replace(tzinfo=UTC)  end = run_after.set(hour=16, minute=30, second=0).replace(tzinfo=UTC)  # c  else:  start = (run_after-delta).set(hour=6, minute=0).replace(tzinfo=UTC)  end = (run_after-delta).set(hour=16, minute=30).replace(tzinfo=UTC)  return DataInterval(start=start, end=end) è£œè¶³ã™ã‚‹ã¨\n ç¾åœ¨æ™‚åˆ»ãŒ06:00~16:30ã®é–“(a)  â‘ ã®å®Ÿè¡Œã¨ã•ã‚Œã‚‹ã€‚ startã¯å‰æ—¥ã®16:30ã€endã¯å½“æ—¥ã®06:00   ç¾åœ¨ã®æ™‚åˆ»ãŒ16:30~23:00ã®é–“(b)  â‘¡ã®å®Ÿè¡Œã¨ã•ã‚Œã‚‹ã€‚ startã¯å½“æ—¥ã®06:00ã€endã¯å½“æ—¥ã®16:30   ãã‚Œä»¥å¤–ã€æ·±å¤œã®00:00~05:59ã®é–“(c)  â‘¡ã®å®Ÿè¡Œã¨ã•ã‚Œã‚‹ã€‚ startã¯å‰æ—¥ã®06:00ã€endã¯å‰æ—¥ã®16:30    plugins_folderé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«  ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€   â”œâ”€â”€ __init__.py â””â”€â”€ timetables â”œâ”€â”€ __init__.py â””â”€â”€ airflow_timetable_template.py  __init__.py  from airflow.plugins_manager import AirflowPlugin import timetables class MyPlugins(AirflowPlugin): name = \"my_plugins_poyo\" timetables = [timetables.MyTimeTable]  timetables/__init__.py  from timetables.airflow_timetable_template import MyTimeTable __all__ = ['MyTimeTable']  timetables/airflow_timetable_template.py ä¸Šè¨˜ã§æ›¸ã„ãŸé–¢æ•°ã‚’ãã®ã¾ã¾ç§»æ¤ã—ã¦ã„ãã¾ã™ã€‚TimeTableåã¯MyTimeTable  from datetime import timedelta from typing import Optional from pendulum import Date, DateTime, Time, timezone from airflow.plugins_manager import AirflowPlugin from airflow.timetables.base import DagRunInfo, DataInterval, TimeRestriction, Timetable UTC = timezone(\"UTC\") class MyTimeTable(Timetable): def infer_manual_data_interval(self, run_after: DateTime) - DataInterval: ãƒ»ãƒ»ãƒ» def next_dagrun_info( self, *, last_automated_data_interval: Optional[DataInterval], restriction: TimeRestriction, ) - Optional[DagRunInfo]: ãƒ»ãƒ»ãƒ» ä½œæˆã‚’åæ˜ ã•ã›ã‚‹ã€‚ webserverã¨schedulerã®å†èµ·å‹•ãŒå¿…è¦ã€‚(TimeTableã¯schedulerã‚‚èª­ã¿è¾¼ã‚€å¿…è¦ãŒã‚ã‚‹ãŸã‚schedulerã‚‚å†èµ·å‹•ã—ã¾ã™ã€‚å†èµ·å‹•ã—ãªã„ã¨TimetableNotRegisteredErrorãŒå‡ºã¾ã™ã€‚)\nä½œæˆã—ãŸTimeTableã‚’è©¦ã—ã¦ã¿ã‚‹ã€‚  dagã®ãƒ•ã‚¡ã‚¤ãƒ« é©å½“ãªDAGã®timetableå¼•æ•°ã«ä½œæˆã—ãŸMyTimeTable:TimeTableã‚’æ¸¡ã™ã€‚importErrorãŒå‡ºã¦ãªã‘ã‚Œã°æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹ã¯ãšã€  from timetables.airflow_timetable_template import MyTimeTable @dag(start_date=days_ago(2), timetable=MyTimeTable()) ...  UIã‹ã‚‰ä½œæˆã—ãŸDAGã®ç¢ºèª  ScheduleãŒMyTimeTableã«ãªã£ã¦ã„ã‚‹ ç¾åœ¨æ™‚åˆ»ãŒ01/05.14:08ã®å ´åˆ  æ¬¡ã®å®Ÿè¡Œã¯01/05.16:30 æ¬¡ã®æ¬¡ã®å®Ÿè¡Œã¯01/06.06:00ã€‚ãã®æ™‚ã®ãƒ‡ãƒ¼ã‚¿é–“éš”ã¯01/05.16:30~01/06.06:00        çµ‚ã‚ã‚Š ä»¥ä¸ŠAirflowã®Pluginã«ã¤ã„ã¦è¦‹ã¦ã„ãã¾ã—ãŸã€‚TimeTableã«ã¤ã„ã¦ã¯ã€Airflowã®Scheduleã«ã¤ã„ã¦å†åº¦ç†è§£ã™ã‚‹æ©Ÿä¼šã«ãªã£ã¦ã‚ˆã‹ã£ãŸã§ã™ã€‚ã¾ãŸæ™‚é–“ãŒã‚ã‚‹ã¨ãã«listenerã‚„executorã®ã‚«ã‚¹ã‚¿ãƒ ã‚‚è©¦ã—ã¦ã¿ãŸã„ã§ã™ã€‚\nå‚è€ƒ  https://docs.astronomer.io/learn/scheduling-in-airflow#timetables https://docs.astronomer.io/learn/using-airflow-plugins https://airflow.apache.org/docs/apache-airflow/stable/plugins.html  ","wordCount":"875","inLanguage":"en","image":"https://user-images.githubusercontent.com/60976262/191047722-dd7ed9ad-6e00-4b50-8073-24ae9602b8d6.png","datePublished":"2023-01-04T11:30:03Z","dateModified":"2023-01-04T11:30:03Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://467tn.com/post/content8/"},"publisher":{"@type":"Organization","name":"-1.9517320122461623","logo":{"@type":"ImageObject","url":"https://github.com/srn221B/srn221B.github.io/assets/60976262/00ebf8b5-eceb-4f87-8e70-df54f431a9b8"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://467tn.com accesskey=h title="  (Alt + H)"><img src=https://467tn.com/home2.png alt aria-label=logo height=35></a><div class=logo-switches></div></div><ul id=menu><li><a href=https://467tn.com/ title=whoami><span>whoami</span></a></li><li><a href=https://467tn.com/archives/ title=archive><span>archive</span></a></li><li><a href=https://467tn.com/tags/ title=tags><span>tags</span></a></li><li><a href=https://filmarks.com/users/467 title=ğŸ¥filmarks><span>ğŸ¥filmarks</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://booklog.jp/users/467 title=ğŸ“šbooklog><span>ğŸ“šbooklog</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://zenn.dev/467 title="ğŸ—’ zenn"><span>ğŸ—’ zenn</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://s6n.hatenablog.com/ title=ğŸ›«travels><span>ğŸ›«travels</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://467tn.com>Home</a>&nbsp;Â»&nbsp;<a href=https://467tn.com/post/>Posts</a></div><h1 class=post-title style=color:#164b60>Airflowã®Pluginsã«ã¤ã„ã¦</h1><div class=post-description>ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ©Ÿèƒ½ã«ã¤ã„ã¦ã§ã™</div><div class=post-meta><span title="2023-01-04 11:30:03 +0000 +0000">January 4, 2023</span>&nbsp;Â·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/srn221B/blog/tree/master/content/post/content8.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#airflowpluginsã¨ã¯>AirflowPluginsã¨ã¯</a><ul><li><a href=#ã©ã‚“ãªæ™‚ã«airflowpluginsã‚’ä½¿ã†ã®ã‹>ã©ã‚“ãªæ™‚ã«AirflowPluginsã‚’ä½¿ã†ã®ã‹</a></li></ul></li><li><a href=#æ–°è¦pluginä½œæˆæ–¹æ³•>æ–°è¦Pluginä½œæˆæ–¹æ³•</a></li><li><a href=#pluginç¢ºèªæ–¹æ³•>Pluginç¢ºèªæ–¹æ³•</a></li><li><a href=#ã©ã‚“ãªcomponentã‚’pluginã«è¿½åŠ ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã®ã‹>ã©ã‚“ãªComponentã‚’Pluginã«è¿½åŠ ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã®ã‹</a><ul><li><a href=#1hooksã‚’ä½¿ç”¨ã—ã¦ç‹¬è‡ªã®hookã‚’ä½œæˆã™ã‚‹>1.hooksã‚’ä½¿ç”¨ã—ã¦ç‹¬è‡ªã®Hookã‚’ä½œæˆã™ã‚‹ã€‚</a></li><li><a href=#2macrosã‚’ä½¿ç”¨ã—ã¦ã‚«ã‚¹ã‚¿ãƒ macroã‚’ä½œæˆã™ã‚‹>2.macrosã‚’ä½¿ç”¨ã—ã¦ã‚«ã‚¹ã‚¿ãƒ macroã‚’ä½œæˆã™ã‚‹ã€‚</a></li><li><a href=#3flask_blueprintsã‚’ä½¿ç”¨ã—ã¦airflowã®flaskã«flaskblueprintè£½ã®ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹>3.flask_blueprintsã‚’ä½¿ç”¨ã—ã¦Airflowã®Flaskã«flask.BluePrintè£½ã®ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹ã€‚</a></li><li><a href=#4appbuilder_viewsã‚’ä½¿ç”¨ã—ã¦airflowã®flaskã«flask_appbuilderbaseviewè£½ã®ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹>4.appbuilder_viewsã‚’ä½¿ç”¨ã—ã¦Airflowã®Flaskã«flask_appbuilder.BaseViewè£½ã®ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹ã€‚</a></li><li><a href=#5appbuilder_menu_itemsã‚’ã—ã¦airflow-uiã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¨ãƒªãƒ³ã‚¯ã‚’ä½œæˆã™ã‚‹>5.appbuilder_menu_itemsã‚’ã—ã¦Airflow UIã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¨ãƒªãƒ³ã‚¯ã‚’ä½œæˆã™ã‚‹ã€‚</a></li><li><a href=#6global_operator_extra_linksã‚’ä½¿ç”¨ã—ã¦å…¨ã¦ã®ç¨®é¡ã®operatorã«linkã‚’ä½œæˆã™ã‚‹>6.global_operator_extra_linksã‚’ä½¿ç”¨ã—ã¦<strong>å…¨ã¦ã®ç¨®é¡ã®</strong>Operatorã«Linkã‚’ä½œæˆã™ã‚‹</a></li><li><a href=#7operator_extra_linksã‚’ä½¿ç”¨ã—ã¦ä»»æ„ã®ç¨®é¡ã®operatorã«linkã‚’ä½œæˆã™ã‚‹>7.operator_extra_linksã‚’ä½¿ç”¨ã—ã¦<strong>ä»»æ„ã®ç¨®é¡ã®</strong>Operatorã«Linkã‚’ä½œæˆã™ã‚‹ã€‚</a></li><li><a href=#8timetablesã‚’ä½¿ç”¨ã—ã¦cronã§ã¯è¡¨ç¾ã§ããªã„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½œæˆã™ã‚‹>8.timetablesã‚’ä½¿ç”¨ã—ã¦CRONã§ã¯è¡¨ç¾ã§ããªã„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½œæˆã™ã‚‹</a></li></ul></li><li><a href=#çµ‚ã‚ã‚Š>çµ‚ã‚ã‚Š</a></li><li><a href=#å‚è€ƒ>å‚è€ƒ</a></li></ul></nav></div></details></div><div class=post-content><h2 id=airflowpluginsã¨ã¯>AirflowPluginsã¨ã¯<a hidden class=anchor aria-hidden=true href=#airflowpluginsã¨ã¯>#</a></h2><p>Airflowã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹ãŸã‚ã«è¿½åŠ ã§ãã‚‹Pluginã€‚</p><h3 id=ã©ã‚“ãªæ™‚ã«airflowpluginsã‚’ä½¿ã†ã®ã‹>ã©ã‚“ãªæ™‚ã«AirflowPluginsã‚’ä½¿ã†ã®ã‹<a hidden class=anchor aria-hidden=true href=#ã©ã‚“ãªæ™‚ã«airflowpluginsã‚’ä½¿ã†ã®ã‹>#</a></h3><p>ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ãªã¨ãã«AirflowPluginsã‚’ä½¿ã†ã€‚</p><ul><li>Airflowã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®DBã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤ºã™ã‚‹Viewã‚’ä½œæˆã—ãŸã„ã¨ãã€‚</li><li>æŒ‡å®šã•ã‚ŒãŸæ™‚é–“å†…ã«ãŠã„ã¦ä»»æ„æ•°ã®DAGãŒå¤±æ•—æ™‚ã«Airflowã®æ©Ÿèƒ½ã‚’ç›£è¦–ã—ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆã‚’é€ä¿¡ã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ãŸã„ã¨ãã€‚</li><li>å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ãƒ„ãƒ¼ãƒ«ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ãƒ­ã‚°ã«å‹•çš„ã«ãƒªãƒ³ã‚¯ã™ã‚‹è©³ç´°ãƒ“ãƒ¥ãƒ¼ã‚’UIã«è¡¨ç¤ºã—ãŸã„ã¨ãã€‚</li></ul><h2 id=æ–°è¦pluginä½œæˆæ–¹æ³•>æ–°è¦Pluginä½œæˆæ–¹æ³•<a hidden class=anchor aria-hidden=true href=#æ–°è¦pluginä½œæˆæ–¹æ³•>#</a></h2><p>ã€Œplugins_folderã€ã¸Pythonãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã—ã€Pythonãƒ•ã‚¡ã‚¤ãƒ«å†…ã§<a href=https://github.com/apache/airflow/blob/a9493c13173f6108c02c42d2f4f60b82b5ccc71a/airflow/plugins_manager.py#L134>airflow.plugins_manager.AirflowPlugin</a>ã‚’æ‹¡å¼µã™ã‚‹ã‚¯ãƒ©ã‚¹ã‚’å®šç¾©ã™ã‚Œã°æ–°è¦Pluginã‚’ä½œæˆã§ãã‚‹ã€‚</p><ul><li>Pythonãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾‹<ul><li>å®šç¾©ã—ãŸAirflowPluginã‚¯ãƒ©ã‚¹ã«ã¯ä»¥ä¸‹ã‚’å®Ÿè£…ã™ã‚‹ã€‚<ul><li><code>name:property</code>ã«Pluginå</li><li><code>on_load:function</code>ã«Pluginã®ãƒ­ãƒ¼ãƒ‰æ™‚ã«å®Ÿè¡Œã—ã¦ã»ã—ã„å‡¦ç†</li><li>ãã®ã»ã‹Pluginã«è¿½åŠ ã—ãŸã„Component(Pluginã®æ©Ÿèƒ½)ã«ã¤ã„ã¦åˆ—æŒ™</li></ul></li></ul></li></ul><pre tabindex=0><code>from airflow.plugins_manager import AirflowPlugin

class MyAirflowPlugin(AirflowPlugin):
    name = &#34;empty&#34;
    def on_load(cls, *args, **kwargs):
        pass
    # ãã®ã»ã‹Pluginã«è¿½åŠ ã—ãŸã„Componentã«ã¤ã„ã¦åˆ—æŒ™ã—ã¦ã„ãã€‚
</code></pre><p>ä¸Šè¨˜å ´åˆã€PluginåãŒã€Œemptyã€ã§ã‚ã‚‹Pluginã‚’ä½œæˆã—ã¦ã„ã‚‹ã€‚</p><ul><li>ã€Œplugins_folderã€ã®ç¢ºèªã®ä»•æ–¹<ul><li>ã¡ãªã¿ã«ã€Œplugins_folderã€ã¯ã©ã“ã§ç¢ºèªã§ãã‚‹ã®ã‹ã¨ã„ã†ã®ã ãŒã€ã€Œã‚³ãƒãƒ³ãƒ‰ã‚’åˆ©ç”¨ã™ã‚‹ã€ã‹ã€Œcfgãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¦‹ã‚‹ã€ã®2é€šã‚Šã§ç¢ºèªã§ãã‚‹ã€‚</li><li>åŸºæœ¬çš„ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯$AIRFLOW_HOME/pluginsã«ãªã£ã¦ã„ã‚‹ã¯ãšã€‚</li></ul></li></ul><pre tabindex=0><code># ã‚³ãƒãƒ³ãƒ‰ã‚’åˆ©ç”¨ã™ã‚‹
$ airflow info  | grep plugins_folder
plugins_folder         | xxx               
# cfgãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¦‹ã‚‹
$ cat airflow.cfg | grep plugins_folder
plugins_folder = xxxx
</code></pre><h2 id=pluginç¢ºèªæ–¹æ³•>Pluginç¢ºèªæ–¹æ³•<a hidden class=anchor aria-hidden=true href=#pluginç¢ºèªæ–¹æ³•>#</a></h2><p>ç¾åœ¨è¿½åŠ ã•ã‚Œã¦ã„ã‚‹Pluginã¯ä½•ã‹ã€Pluginã«å®šç¾©ã•ã‚Œã¦ã‚ã‚‹Componentã¯ä½•ã‹ã‚’ç¢ºèªã™ã‚‹æ–¹æ³•ã ãŒã€ã€ŒUIã‹ã‚‰ç¢ºèªã™ã‚‹æ–¹æ³•ã€ã¨ã€ŒCLIã‚’åˆ©ç”¨ã—ã¦ç¢ºèªã™ã‚‹æ–¹æ³•ã€ãŒã‚ã‚‹ã€‚WebServerã‚’å†èµ·å‹•ã—ãªãã¦ã‚‚ã™ãã«åæ˜ ã•ã‚Œã‚‹ã®ã¯å¾Œè€…ã®æ–¹æ³•ã€‚</p><ul><li>ã€ŒUIã‹ã‚‰ç¢ºèªã™ã‚‹æ–¹æ³•ã€<ul><li>UIã®Admin->Pluginsã‚’ä½¿ç”¨ã™ã‚‹ã€‚</li></ul></li></ul><p><img loading=lazy src=https://storage.googleapis.com/zenn-user-upload/47201792a899-20230105.png alt></p><ul><li>ã€ŒCLIã‚’åˆ©ç”¨ã—ã¦ç¢ºèªã™ã‚‹æ–¹æ³•ã€<ul><li>airflow pluginsã‚’å®Ÿè¡Œã™ã‚‹ã€‚</li></ul></li></ul><pre tabindex=0><code>$ airflow plugins
name            | source                      | appbuilder_views                                                                            | macros               
================+=============================+=============================================================================================+======================
my_plugins_poyo | $PLUGINS_FOLDER/__init__.py | {&#39;name&#39;: &#39;Test View&#39;, &#39;category&#39;: &#39;Test Plugin&#39;, &#39;view&#39;: &#39;__init__.TestAppBuilderBaseView&#39;} | __init__.plugin_macro
</code></pre><h2 id=ã©ã‚“ãªcomponentã‚’pluginã«è¿½åŠ ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã®ã‹>ã©ã‚“ãªComponentã‚’Pluginã«è¿½åŠ ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã®ã‹<a hidden class=anchor aria-hidden=true href=#ã©ã‚“ãªcomponentã‚’pluginã«è¿½åŠ ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã®ã‹>#</a></h2><p>ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ãªComponentãŒç¾åœ¨ã‚ã‚‹ã€‚ç¨®é¡ã¨ã—ã¦UIã¸ã®æ©Ÿèƒ½è¿½åŠ ã‹ã‚‰Schedulingã€DAGä½œæˆã™ã‚‹ä¸Šã§ã®æ©Ÿèƒ½è¿½åŠ ãªã©ãªã©ãŒã‚ã‚‹ã€‚è©³ç´°ã«ã¤ã„ã¦ã¯<a href=https://airflow.apache.org/docs/apache-airflow/stable/plugins.html>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a>ã‚’ç¢ºèªã™ã‚‹ã¨è‰¯ã„ã€‚</p><table><thead><tr><th>No</th><th>Component</th><th>About</th></tr></thead><tbody><tr><td>1</td><td>hooks</td><td>ç‹¬è‡ªã®Hookã‚’ä½œæˆã™ã‚‹</td></tr><tr><td>2</td><td>macros</td><td>ã‚«ã‚¹ã‚¿ãƒ macroã‚’ä½œæˆã™ã‚‹</td></tr><tr><td>3</td><td>flask_blueprints</td><td>Airflowã®Flaskã«flask.BluePrintè£½ã®ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹</td></tr><tr><td>4</td><td>appbuilder_views</td><td>Airflowã®Flaskã«flask_appbuilder.BaseViewè£½ã®ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹</td></tr><tr><td>5</td><td>appbuilder_menu_items</td><td>Airflow UIã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¨ãƒªãƒ³ã‚¯ã‚’ä½œæˆã™ã‚‹</td></tr><tr><td>6</td><td>global_operator_extra_links</td><td><strong>å…¨ã¦ã®ç¨®é¡ã®</strong>Operatorã«Linkã‚’ä½œæˆã™ã‚‹</td></tr><tr><td>7</td><td>operator_extra_links</td><td><strong>ä»»æ„ã®ç¨®é¡ã®</strong>Operatorã«Linkã‚’ä½œæˆã™ã‚‹</td></tr><tr><td>8</td><td>timetables</td><td>CRONã§ã¯è¡¨ç¾ã§ããªã„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½œæˆã™ã‚‹</td></tr></tbody></table><p>ãã®ã»ã‹ã€Œexecutorã‚’ä½¿ç”¨ã—ã¦CustomExecutorã‚’ä½œæˆã™ã‚‹ã€ã€Œlistenerã‚’ä½¿ç”¨ã—ã¦ã‚¤ãƒ™ãƒ³ãƒˆæ¤œçŸ¥ã‚’ä½œæˆã™ã‚‹ã€ãªã©ã§ããã†ã€‚</p><p>ä»Šå›ã¯ä¸Šè¨˜ã®Componentã®ã¿é †ã«è©¦ã—ã¦ã¿ã¾ã™ã€‚</p><hr><h3 id=1hooksã‚’ä½¿ç”¨ã—ã¦ç‹¬è‡ªã®hookã‚’ä½œæˆã™ã‚‹>1.hooksã‚’ä½¿ç”¨ã—ã¦ç‹¬è‡ªã®Hookã‚’ä½œæˆã™ã‚‹ã€‚<a hidden class=anchor aria-hidden=true href=#1hooksã‚’ä½¿ç”¨ã—ã¦ç‹¬è‡ªã®hookã‚’ä½œæˆã™ã‚‹>#</a></h3><h4 id=airflowã®hookã¨ã¯>Airflowã®Hookã¨ã¯<a hidden class=anchor aria-hidden=true href=#airflowã®hookã¨ã¯>#</a></h4><p>å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ ã¨ã®ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã®å½¹å‰²ã‚’ã—ã¦ãã‚Œã‚‹ã‚ˆã†ãªã‚‚ã®ã€‚ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ã„ã¦ä¸€è²«ã—ãŸãƒ¡ã‚½ãƒƒãƒ‰ã‚’æä¾›ã™ã‚‹ã“ã¨ã‚’æ„å›³ã¨ã—ã¦ã‚ã‚‹ã€‚</p><pre tabindex=0><code>pg_hook = PostgresHook.get_hook(conn_id)
pg_hook.copy_exper()
</code></pre><p>è©³ç´°ï¼š<a href=https://airflow.apache.org/docs/apache-airflow/stable/concepts/connections.html>https://airflow.apache.org/docs/apache-airflow/stable/concepts/connections.html</a></p><h4 id=plugins_folderé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«>plugins_folderé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«<a hidden class=anchor aria-hidden=true href=#plugins_folderé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«>#</a></h4><p>ä»Šå›ã¯æ¬¡ã®ã‚ˆã†ãªãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ ã§æ–°è¦ç‹¬è‡ªã®Hookã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚</p><pre tabindex=0><code>.
â”œâ”€â”€ __init__.pyã€€# pluginã«ã¤ã„ã¦å®šç¾©
â”œâ”€â”€ hooks
â”‚Â Â  â”œâ”€â”€ __init__.py
â”‚Â Â  â””â”€â”€ airflow_hook_template.py # Hookã«ã¤ã„ã¦å®šç¾©
</code></pre><ul><li><code>__init__.py</code></li></ul><pre tabindex=0><code>from __future__ import division, absolute_import, print_function
import hooks
from airflow.plugins_manager import AirflowPlugin


class MyPlugins(AirflowPlugin):
    name = &#34;my_plugins_poyo&#34;
    hooks = [hooks.PluginHook]
</code></pre><ul><li><code>hooks/__init__.py</code></li></ul><pre tabindex=0><code>from hooks.airflow_hook_template import PluginHook

__all__ = [&#39;PluginHook&#39;]
</code></pre><ul><li><code>hooks/airflow_hook_template.py</code><ul><li>airflow.hooks.base.BaseHookã‚’æ‹¡å¼µã—ã¦æ›¸ãã€‚</li></ul></li></ul><pre tabindex=0><code>from airflow.hooks.base import BaseHook


class PluginHook(BaseHook):
    pass
</code></pre><p>ä¸Šè¨˜ã®å ´åˆã€ç‰¹ã«ä½•ã‚‚ã—ãªã„Hookã€‚</p><h4 id=ä½œæˆã‚’åæ˜ ã•ã›ã‚‹>ä½œæˆã‚’åæ˜ ã•ã›ã‚‹ã€‚<a hidden class=anchor aria-hidden=true href=#ä½œæˆã‚’åæ˜ ã•ã›ã‚‹>#</a></h4><p>webserverã®å†èµ·å‹•ãŒå¿…è¦ã€‚</p><h4 id=dagã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰importã—ã¦ã¿ã‚‹>dagã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰importã—ã¦ã¿ã‚‹<a hidden class=anchor aria-hidden=true href=#dagã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰importã—ã¦ã¿ã‚‹>#</a></h4><p>plugins_folderã¯ç’°å¢ƒå¤‰æ•°<code>PYTHONPATH</code>ã¨ã—ã¦è‡ªå‹•çš„ã«buildã•ã‚Œã¦ã„ã‚‹(<a href=https://airflow.apache.org/docs/apache-airflow/stable/modules_management.html#built-in-pythonpath-entries-in-airflow>https://airflow.apache.org/docs/apache-airflow/stable/modules_management.html#built-in-pythonpath-entries-in-airflow</a>)ã®ã§,ç›´æ¥plugins_folderé…ä¸‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®šã™ã‚‹å½¢ã§importã§ãã‚‹ã€‚UIã‹ã‚‰DAGã‚’ç¢ºèªã™ã‚‹ãªã©ã‚’ã—ã¦importErrorãŒå‡ºã¦ã„ãªã‘ã‚Œã°æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹ã€‚</p><ul><li>dagã®ãƒ•ã‚¡ã‚¤ãƒ«</li></ul><pre tabindex=0><code>from hooks.airflow_hook_template import PluginHook
</code></pre><hr><h3 id=2macrosã‚’ä½¿ç”¨ã—ã¦ã‚«ã‚¹ã‚¿ãƒ macroã‚’ä½œæˆã™ã‚‹>2.macrosã‚’ä½¿ç”¨ã—ã¦ã‚«ã‚¹ã‚¿ãƒ macroã‚’ä½œæˆã™ã‚‹ã€‚<a hidden class=anchor aria-hidden=true href=#2macrosã‚’ä½¿ç”¨ã—ã¦ã‚«ã‚¹ã‚¿ãƒ macroã‚’ä½œæˆã™ã‚‹>#</a></h3><h4 id=macroã¨ã¯>macroã¨ã¯<a hidden class=anchor aria-hidden=true href=#macroã¨ã¯>#</a></h4><p>JinjaTemplateã‚’ä½¿ç”¨ã—ã¦Taskå†…ã§åˆ©ç”¨ã§ãã‚‹å¤‰æ•°ã®ã‚ˆã†ãªã‚‚ã®ã€‚</p><pre tabindex=0><code>print(&#39;å®Ÿè¡Œæ—¥ã¯ {{execution_date}}&#39;)
</code></pre><p>è©³ç´°ï¼š<a href=https://airflow.apache.org/docs/apache-airflow/stable/templates-ref.html>https://airflow.apache.org/docs/apache-airflow/stable/templates-ref.html</a></p><h4 id=plugins_folderé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«-1>plugins_folderé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«<a hidden class=anchor aria-hidden=true href=#plugins_folderé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«-1>#</a></h4><p>plugins_folderé…ä¸‹ã«<code>__init__.py</code>ã‚’ä½œæˆã—ã¦ãã“ã«è¨˜è¼‰ã™ã‚‹å½¢ã§æ›¸ã„ã¦ã„ãã€‚</p><ul><li><code>__init__.py</code><ul><li>é–¢æ•°ã«ä½œæˆã™ã‚‹macroã«ã¤ã„ã¦å®šç¾©ã—ã¦ã„ãã€‚<ul><li>é–¢æ•°åãŒmacroå</li><li>é–¢æ•°ã®æˆ»ã‚Šå€¤ãŒmacroã®valueã¨ãªã‚‹</li></ul></li></ul></li></ul><pre tabindex=0><code>from airflow.plugins_manager import AirflowPlugin

def plugin_macro(x: int): 
    return x + 1 

class MyPlugins(AirflowPlugin):
    name = &#34;my_plugins_poyo&#34;
    macros = [plugin_macro]
</code></pre><p>ä¸Šè¨˜ã®å ´åˆã€<code>plugin_macro</code>ã¨ã„ã†macroã‚’å®šç¾©ã—ã¦ãŠã‚Šã€ãã®macroã¯å¼•æ•°<code>x:int</code>ã‚’<code>x + 1</code>ã—ãŸå½¢ã§è¿”ã™ã¨ã„ã†ã“ã¨ã‚’ã—ã¦ã„ã‚‹ã€‚</p><h4 id=ä½œæˆã‚’åæ˜ ã•ã›ã‚‹-1>ä½œæˆã‚’åæ˜ ã•ã›ã‚‹ã€‚<a hidden class=anchor aria-hidden=true href=#ä½œæˆã‚’åæ˜ ã•ã›ã‚‹-1>#</a></h4><p>webserverã®å†èµ·å‹•ãŒå¿…è¦ã€‚</p><h4 id=dagã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰åˆ©ç”¨ã—ã¦ã¿ã‚‹>dagã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰åˆ©ç”¨ã—ã¦ã¿ã‚‹<a hidden class=anchor aria-hidden=true href=#dagã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰åˆ©ç”¨ã—ã¦ã¿ã‚‹>#</a></h4><ul><li>dagã®ãƒ•ã‚¡ã‚¤ãƒ«<ul><li>ä½œæˆã—ãŸmacroã¯<code>macros.&lt;plugin_name>.&lt;macro_name></code>ã§å–å¾—ã§ãã‚‹ã€‚</li></ul></li></ul><pre tabindex=0><code>from airflow.decorators import task, dag
from airflow.utils.dates import days_ago

@task
def test_output(**kwargs):
    macros = kwargs[&#39;macros&#39;]
    input = 1
    print(f&#39;input: {input}&#39;)
    print(f&#39;output: {macros.my_plugins_poyo.plugin_macro(input)}&#39;)

@dag(start_date=days_ago(2))
def test_plugins():
    test_output()
    
test_plugins()
</code></pre><ul><li>log<ul><li>ä¸Šè¨˜DAGã‚’å®Ÿè¡Œã—ã¦ã¿ãŸLogã ãŒã€å¼•æ•°<code>1</code>ã«å¯¾ã—outputãŒ<code>2</code>ã¨ãªã£ã¦ã„ã‚‹ã®ã§macroãŒåŠ¹ã„ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã‚‹ã€‚</li></ul></li></ul><pre tabindex=0><code>[2023-01-04, 18:31:16 JST] {logging_mixin.py:137} INFO - input: 1
[2023-01-04, 18:31:16 JST] {logging_mixin.py:137} INFO - output: 2
</code></pre><hr><h3 id=3flask_blueprintsã‚’ä½¿ç”¨ã—ã¦airflowã®flaskã«flaskblueprintè£½ã®ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹>3.flask_blueprintsã‚’ä½¿ç”¨ã—ã¦Airflowã®Flaskã«flask.BluePrintè£½ã®ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹ã€‚<a hidden class=anchor aria-hidden=true href=#3flask_blueprintsã‚’ä½¿ç”¨ã—ã¦airflowã®flaskã«flaskblueprintè£½ã®ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹>#</a></h3><h4 id=flaskblueprintã¨ã¯>flask.BluePrintã¨ã¯<a hidden class=anchor aria-hidden=true href=#flaskblueprintã¨ã¯>#</a></h4><p>Flaskå†…ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æ©Ÿèƒ½ã‚’è¤‡æ•°ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ†å‰²ã™ã‚‹æ–¹æ³•ã€‚ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒé•·ã™ãã‚‹å ´åˆã«ã€æ©Ÿèƒ½ã”ã¨ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†å‰²ã—ç®¡ç†ã—ã‚„ã™ãã™ã‚‹ãŸã‚ã«åˆ©ç”¨ã™ã‚‹ã€‚</p><h4 id=plugins_folderé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«-2>plugins_folderé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«<a hidden class=anchor aria-hidden=true href=#plugins_folderé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«-2>#</a></h4><p>plugins_folderé…ä¸‹ã«<code>__init__.py</code>ã‚’ä½œæˆã—ã¦ãã“ã«è¨˜è¼‰ã™ã‚‹å½¢ã§æ›¸ã„ã¦ã„ãã€‚</p><ul><li><code>__init__.py</code><ul><li>airflow.plugins_manager.AirflowPluginã‚’æ‹¡å¼µã—ã¦ã‹ãã€‚</li><li><code>@bp.route</code>ã«æ¸¡ã—ãŸãƒ‘ã‚¹ãŒè¿½åŠ ã—ãŸã„ãƒšãƒ¼ã‚¸ã®<code>http://&lt;airflow webserver IP>:&lt;port>/</code>ç›´ä¸‹ã®Subpathã¨ãªã‚‹ã€‚</li></ul></li></ul><pre tabindex=0><code>from flask import Blueprint
from airflow.plugins_manager import AirflowPlugin


bp = Blueprint(&#39;app2&#39;, __name__)

@bp.route(&#39;/bp_test&#39;)
def bp_test():
    &#34;&#34;&#34; ä»Šæ—¥ã®å¤©æ°—ã‚’å–å¾—ã—ã¦è¡¨ç¤ºã™ã‚‹
    &#34;&#34;&#34;
    import requests
    import json
    res = requests.get(&#39;https://weather.tsukumijima.net/api/forecast/city/220030&#39;)
    today_weather = json.loads(res.text)[&#39;forecasts&#39;][0]
    return today_weather[&#39;date&#39;] + &#39; &#39; + today_weather[&#39;detail&#39;][&#39;weather&#39;]

class MyPlugins(AirflowPlugin):
    name = &#34;my_plugins_poyo&#34;
    flask_blueprints = [bp]
</code></pre><p>ä¸Šè¨˜ã®å ´åˆã€SubpathãŒ<code>/bp_test</code>ã§ã‚ã‚‹ãƒšãƒ¼ã‚¸ã‚’è¿½åŠ ã—ã¦ãŠã‚Šã€ãƒšãƒ¼ã‚¸ã‚’é–‹ãã¨weatherAPIã‚’ä½¿ç”¨ã—ã¦ä»»æ„ã®å¸‚ã®ä»Šæ—¥ã®æ—¥ä»˜ã¨å¤©æ°—ã‚’å–å¾—ã—è¡¨ç¤ºã™ã‚‹ã‚ˆã†ãªã“ã¨ã‚’ã—ã¦ã„ã‚‹ã€‚</p><h4 id=ä½œæˆã‚’åæ˜ ã•ã›ã‚‹-2>ä½œæˆã‚’åæ˜ ã•ã›ã‚‹ã€‚<a hidden class=anchor aria-hidden=true href=#ä½œæˆã‚’åæ˜ ã•ã›ã‚‹-2>#</a></h4><p>webserverã®å†èµ·å‹•ãŒå¿…è¦ã€‚</p><h4 id=ä½œæˆã—ãŸãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã‚‹>ä½œæˆã—ãŸãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã‚‹ã€‚<a hidden class=anchor aria-hidden=true href=#ä½œæˆã—ãŸãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã‚‹>#</a></h4><ul><li><code>http://&lt;airflow webserver IP>:&lt;port>/bp_test</code>ã¸ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã€‚</li></ul><p><img loading=lazy src=https://storage.googleapis.com/zenn-user-upload/abade4eefcce-20230104.png alt></p><hr><h3 id=4appbuilder_viewsã‚’ä½¿ç”¨ã—ã¦airflowã®flaskã«flask_appbuilderbaseviewè£½ã®ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹>4.appbuilder_viewsã‚’ä½¿ç”¨ã—ã¦Airflowã®Flaskã«flask_appbuilder.BaseViewè£½ã®ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹ã€‚<a hidden class=anchor aria-hidden=true href=#4appbuilder_viewsã‚’ä½¿ç”¨ã—ã¦airflowã®flaskã«flask_appbuilderbaseviewè£½ã®ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹>#</a></h3><h4 id=flask_appbuilderbaseviewã¨ã¯>flask_appbuilder.BaseViewã¨ã¯<a hidden class=anchor aria-hidden=true href=#flask_appbuilderbaseviewã¨ã¯>#</a></h4><p>Flaskã®Viewã®ã†ã¡ã€ã‚ˆã‚Šãã‚ç´°ã‹ãã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£(ãƒ¡ã‚½ãƒƒãƒ‰,ã‚¢ã‚¯ã‚»ã‚¹)ã‚’è¨­å®šã§ãã‚‹Viewã€‚</p><h4 id=plugins_folderé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«-3>plugins_folderé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«<a hidden class=anchor aria-hidden=true href=#plugins_folderé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«-3>#</a></h4><p>plugins_folderé…ä¸‹ã«<code>__init__.py</code>ã‚’ä½œæˆã—ã¦ãã“ã«è¨˜è¼‰ã™ã‚‹å½¢ã§æ›¸ã„ã¦ã„ãã€‚</p><ul><li><code>__init__.py</code><ul><li>Airflowã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«Viewã®Linkã‚’è¨­å®šã™ã‚‹å½¢ã§æ›¸ã„ã¦ã„ãã€‚<ul><li><code>category:str</code>ã«æ¸¡ã—ãŸå€¤ãŒãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼å</li><li><code>name:str</code>ã«æ¸¡ã—ãŸå€¤ãŒã‚»ã‚¯ã‚·ãƒ§ãƒ³å</li></ul></li></ul></li></ul><pre tabindex=0><code>from airflow.plugins_manager import AirflowPlugin
from flask_appbuilder import expose, BaseView as AppBuilderBaseView


class TestAppBuilderBaseView(AppBuilderBaseView):
    default_view = &#34;test&#34;
    @expose(&#39;/&#39;)
    def test(self):
        &#34;&#34;&#34; hello test_pageã‚’è¡¨ç¤ºã™ã‚‹
        &#34;&#34;&#34;
        return &#39;hello test_page&#39;

v_appbuilder_view = TestAppBuilderBaseView()
v_appbuilder_package = {
    &#34;name&#34;: &#34;Test View&#34;,
    &#34;category&#34;: &#34;Test Plugin&#34;,
    &#34;view&#34;: v_appbuilder_view,
}

class MyPlugins(AirflowPlugin):
    name = &#34;my_plugins_poyo&#34;
    appbuilder_views = [v_appbuilder_package]
</code></pre><p>ä¸Šè¨˜ã®å ´åˆã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼å<code>Test Plugin</code>ã‚»ã‚¯ã‚·ãƒ§ãƒ³å<code>Test View</code>ã«Viewã¸ã®Linkã‚’è¨­å®šã—ã¦ãŠã‚Šã€Linkã‚’ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨&rsquo;hello test_page&rsquo;ã¨è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’æœŸå¾…ã—ã¦ã„ã‚‹ã€‚</p><h4 id=ä½œæˆã‚’åæ˜ ã•ã›ã‚‹-3>ä½œæˆã‚’åæ˜ ã•ã›ã‚‹ã€‚<a hidden class=anchor aria-hidden=true href=#ä½œæˆã‚’åæ˜ ã•ã›ã‚‹-3>#</a></h4><p>webserverã®å†èµ·å‹•ãŒå¿…è¦ã€‚</p><h4 id=ä½œæˆã—ãŸãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã‚‹-1>ä½œæˆã—ãŸãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã‚‹ã€‚<a hidden class=anchor aria-hidden=true href=#ä½œæˆã—ãŸãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã‚‹-1>#</a></h4><ul><li>æœŸå¾…é€šã‚Šã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒã§ãã¦ã„ã‚‹ã€‚</li></ul><p><img loading=lazy src=https://storage.googleapis.com/zenn-user-upload/7e0c9ebbbf00-20230105.png alt></p><ul><li>Viewã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã‚‹ã¨ãƒšãƒ¼ã‚¸ãŒæ­£å¸¸ã«ç¢ºèªã§ãã‚‹ã€‚</li></ul><p><img loading=lazy src=https://storage.googleapis.com/zenn-user-upload/c86b0a906497-20230105.png alt></p><hr><h3 id=5appbuilder_menu_itemsã‚’ã—ã¦airflow-uiã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¨ãƒªãƒ³ã‚¯ã‚’ä½œæˆã™ã‚‹>5.appbuilder_menu_itemsã‚’ã—ã¦Airflow UIã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¨ãƒªãƒ³ã‚¯ã‚’ä½œæˆã™ã‚‹ã€‚<a hidden class=anchor aria-hidden=true href=#5appbuilder_menu_itemsã‚’ã—ã¦airflow-uiã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¨ãƒªãƒ³ã‚¯ã‚’ä½œæˆã™ã‚‹>#</a></h3><h4 id=plugins_folderé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«-4>plugins_folderé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«<a hidden class=anchor aria-hidden=true href=#plugins_folderé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«-4>#</a></h4><p>plugins_folderé…ä¸‹ã«<code>__init__.py</code>ã‚’ä½œæˆã—ã¦ãã“ã«è¨˜è¼‰ã™ã‚‹å½¢ã§æ›¸ã„ã¦ã„ãã€‚</p><ul><li><code>__init__.py</code><ul><li>4.appbuilder_viewsã®èª¬æ˜ã¨åŒæ§˜<ul><li><code>category:str</code>ã«æ¸¡ã—ãŸå€¤ãŒãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼å</li><li><code>name:str</code>ã«æ¸¡ã—ãŸå€¤ãŒã‚»ã‚¯ã‚·ãƒ§ãƒ³å</li></ul></li></ul></li></ul><pre tabindex=0><code>from airflow.plugins_manager import AirflowPlugin

appbuilder_mitem = {
    &#34;name&#34;: &#34;467 notes&#34;,
    &#34;href&#34;: &#34;https://467tn.com&#34;,
    &#34;category&#34;: &#34;MyPages&#34;,
}

class MyPlugins(AirflowPlugin):
    name = &#34;my_plugins_poyo&#34;
    appbuilder_menu_items = [appbuilder_mitem]
</code></pre><p>ä¸Šè¨˜ã®å ´åˆã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼å<code>MyPages</code>ã‚»ã‚¯ã‚·ãƒ§ãƒ³å<code>467 notes</code>ã«Viewã¸ã®Linkã‚’è¨­å®šã—ã¦ãŠã‚Šã€Linkã‚’ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨<code>href</code>å…ˆã®ãƒšãƒ¼ã‚¸ã¸é·ç§»ã•ã‚Œã‚‹ã“ã¨ã‚’æœŸå¾…ã—ã¦ã„ã‚‹ã€‚</p><h4 id=ä½œæˆã‚’åæ˜ ã•ã›ã‚‹-4>ä½œæˆã‚’åæ˜ ã•ã›ã‚‹ã€‚<a hidden class=anchor aria-hidden=true href=#ä½œæˆã‚’åæ˜ ã•ã›ã‚‹-4>#</a></h4><p>webserverã®å†èµ·å‹•ãŒå¿…è¦ã€‚</p><h4 id=ä½œæˆã—ãŸãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã‚‹-2>ä½œæˆã—ãŸãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã‚‹ã€‚<a hidden class=anchor aria-hidden=true href=#ä½œæˆã—ãŸãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã‚‹-2>#</a></h4><ul><li>æœŸå¾…é€šã‚Šã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒã§ãã¦ã„ã‚‹ã€‚ã¾ãŸã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³å…ˆã‚’ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨<code>https://467tn.com</code>ã¸é·ç§»ã•ã‚Œã‚‹ã€‚</li></ul><p><img loading=lazy src=https://storage.googleapis.com/zenn-user-upload/b45c75284248-20230105.png alt></p><hr><h3 id=6global_operator_extra_linksã‚’ä½¿ç”¨ã—ã¦å…¨ã¦ã®ç¨®é¡ã®operatorã«linkã‚’ä½œæˆã™ã‚‹>6.global_operator_extra_linksã‚’ä½¿ç”¨ã—ã¦<strong>å…¨ã¦ã®ç¨®é¡ã®</strong>Operatorã«Linkã‚’ä½œæˆã™ã‚‹<a hidden class=anchor aria-hidden=true href=#6global_operator_extra_linksã‚’ä½¿ç”¨ã—ã¦å…¨ã¦ã®ç¨®é¡ã®operatorã«linkã‚’ä½œæˆã™ã‚‹>#</a></h3><h4 id=airflowã®operatorlinkã¨ã¯>Airflowã®OperatorLinkã¨ã¯<a hidden class=anchor aria-hidden=true href=#airflowã®operatorlinkã¨ã¯>#</a></h4><p>Taskã®è©³ç´°ç”»é¢ã«ã¤ã‘ã‚‹ãƒœã‚¿ãƒ³Link(ã†ã¾ã„è¡¨ç¾ãŒã‚ã‹ã‚Šã¾ã›ã‚“)ã€‚åŸºåº•ãŒ<a href=https://airflow.apache.org/docs/apache-airflow/stable/_api/airflow/models/baseoperator/index.html>BaseOperatorLink</a>ã¨ãªã£ã¦ãŠã‚Šã€ãƒœã‚¿ãƒ³Linkã‚’Clickã™ã‚‹ã¨å½“ã‚¯ãƒ©ã‚¹ã®<code>get_link:function</code>ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã‚ã‘ã ãŒã€<code>get_link:function</code>ã«ã¯å¼•æ•°ã¨ã—ã¦å½“Taskã®operator(BaseOperator)ã¨ti_key(airflow.models.taskinstance.TaskInstanceKey)ãŒæ¸¡ã•ã‚Œã‚‹ã€‚ãªã®ã§ã“ã®OperatorLinkã‚’ä½¿ãˆã°ã€OperatorãŒå¤–éƒ¨ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã¨é€šä¿¡ã™ã‚‹ã‚ˆã†ãªOperatorã ã£ãŸå ´åˆã«å¤–éƒ¨ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹å…ˆã«ã‚ã‚‹Logãªã©ã‚’<code>ti_key</code>ã‚’ã‚‚ã¨ã«è¡¨ç¤ºã™ã‚‹ã‚ˆã†ãªã“ã¨ãŒã§ãã¾ã™ã€‚
ä¾‹ãˆã°æ¨™æº–ã§provideã•ã‚Œã¦ã„ã‚‹OperatorLinkã®ã†ã¡ã€BigQueryConsoleLinkã¯ã€BigQueryOperatorã‚’ä½¿ç”¨ã—ã¦BigQueryã«æŠ•ã’ãŸLogã‚’GoogleCloudConsoleã‹ã‚‰å½“job_idã‚’æŒ‡å®šã—ã¦ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ãªä»•æ§˜ã‚’ã—ã¦ã„ã‚‹OperatorLinkã§ã™ã€‚</p><p>è©³ç´°ï¼š<a href=https://airflow.apache.org/docs/apache-airflow/stable/howto/define_extra_link.html>https://airflow.apache.org/docs/apache-airflow/stable/howto/define_extra_link.html</a></p><h4 id=plugins_folderé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«-5>plugins_folderé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«<a hidden class=anchor aria-hidden=true href=#plugins_folderé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«-5>#</a></h4><p>plugins_folderé…ä¸‹ã«<code>__init__.py</code>ã‚’ä½œæˆã—ã¦ãã“ã«è¨˜è¼‰ã™ã‚‹å½¢ã§æ›¸ã„ã¦ã„ãã€‚</p><ul><li><code>__init__.py</code><ul><li><a href=https://airflow.apache.org/docs/apache-airflow/stable/_api/airflow/models/baseoperator/index.html>BaseOperatorLink</a>ã‚’æ‹¡å¼µã—ã¦æ›¸ãã€‚<ul><li><code>name:property</code>ã«æ¸¡ã—ãŸå€¤ãŒãƒœã‚¿ãƒ³Linkå</li><li><code>get_link:function</code>ã«å®šç¾©ã—ãŸå‡¦ç†ã¯ãƒœã‚¿ãƒ³Linkã‚’Clickã—ãŸæ™‚ã«å‹•ä½œã™ã‚‹æŒ™å‹•ã€‚<ul><li>æˆ»ã‚Šå€¤ã¨ã—ã¦strã§LinkPathã‚’è¨˜è¼‰ã€‚</li></ul></li></ul></li></ul></li></ul><pre tabindex=0><code>from airflow.plugins_manager import AirflowPlugin
from airflow.models.baseoperator import BaseOperatorLink

class GlobalLink(BaseOperatorLink):
    name = &#34;Airflow docs&#34;

    def get_link(self, operator, *, ti_key=None):
        return &#34;https://airflow.apache.org/&#34;


class MyPlugins(AirflowPlugin):
    name = &#34;my_plugins_poyo&#34;
    global_operator_extra_links = [
        GlobalLink(),
    ]
</code></pre><p>ä¸Šè¨˜ã®å ´åˆã€<code>Airflow docs</code>ã¨ã„ã†ãƒœã‚¿ãƒ³Linkã‚’ä½œæˆã—ã¦ãŠã‚Šã€ãƒœã‚¿ãƒ³Linkã‚’Clickã™ã‚‹ã¨<code>https://airflow.apache.org/</code>ã¸é·ç§»ã™ã‚‹ã€‚</p><h4 id=ä½œæˆã‚’åæ˜ ã•ã›ã‚‹-5>ä½œæˆã‚’åæ˜ ã•ã›ã‚‹ã€‚<a hidden class=anchor aria-hidden=true href=#ä½œæˆã‚’åæ˜ ã•ã›ã‚‹-5>#</a></h4><p>webserverã®å†èµ·å‹•ãŒå¿…è¦ã€‚</p><h4 id=ä½œæˆã—ãŸlinkã‚’ç¢ºèªã—ã¦ã¿ã‚‹>ä½œæˆã—ãŸLinkã‚’ç¢ºèªã—ã¦ã¿ã‚‹ã€‚<a hidden class=anchor aria-hidden=true href=#ä½œæˆã—ãŸlinkã‚’ç¢ºèªã—ã¦ã¿ã‚‹>#</a></h4><ul><li>ä»»æ„ã®Taskã®è©³ç´°ã‚’é–‹ãã¨Operatorã®ç¨®é¡ã«é™ã‚‰ãšæœŸå¾…é€šã‚Šã®ãƒœã‚¿ãƒ³LinkãŒä½œã‚‰ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã‚‹ã€‚ãƒœã‚¿ãƒ³Linkã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨<code>https://airflow.apache.org/</code>ã¸é·ç§»ã™ã‚‹ã€‚</li></ul><p><img loading=lazy src=https://storage.googleapis.com/zenn-user-upload/904f888118ac-20230105.png alt></p><hr><h3 id=7operator_extra_linksã‚’ä½¿ç”¨ã—ã¦ä»»æ„ã®ç¨®é¡ã®operatorã«linkã‚’ä½œæˆã™ã‚‹>7.operator_extra_linksã‚’ä½¿ç”¨ã—ã¦<strong>ä»»æ„ã®ç¨®é¡ã®</strong>Operatorã«Linkã‚’ä½œæˆã™ã‚‹ã€‚<a hidden class=anchor aria-hidden=true href=#7operator_extra_linksã‚’ä½¿ç”¨ã—ã¦ä»»æ„ã®ç¨®é¡ã®operatorã«linkã‚’ä½œæˆã™ã‚‹>#</a></h3><h4 id=operatorlinkã¨ã¯>OperatorLinkã¨ã¯<a hidden class=anchor aria-hidden=true href=#operatorlinkã¨ã¯>#</a></h4><p>ã€Œ6.global_operator_extra_linksã€ã§ã®èª¬æ˜ã¨åŒæ§˜ãªã®ã§å‰²æ„›ã€‚</p><h4 id=plugins_folderé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«-6>plugins_folderé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«<a hidden class=anchor aria-hidden=true href=#plugins_folderé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«-6>#</a></h4><p>plugins_folderé…ä¸‹ã«<code>__init__.py</code>ã‚’ä½œæˆã—ã¦ãã“ã«è¨˜è¼‰ã™ã‚‹å½¢ã§æ›¸ã„ã¦ã„ãã€‚</p><ul><li><code>__init__.py</code><ul><li><a href=https://airflow.apache.org/docs/apache-airflow/stable/_api/airflow/models/baseoperator/index.html>BaseOperatorLink</a>ã‚’æ‹¡å¼µã—ã¦æ›¸ãã€‚<ul><li><code>name:property</code>ã¨<code>get_link:function</code>ã®ä»•æ§˜ã«ã¤ã„ã¦ã¯ã€Œ6.global_operator_extra_linksã€ã§ã®èª¬æ˜ã¨åŒæ§˜ã€‚</li><li><code>operators:List[BaseOperator]</code>ã«Linkã‚’åæ˜ ã—ãŸã„Operatorã‚’åˆ—æŒ™ã™ã‚‹ã€‚</li></ul></li></ul></li></ul><pre tabindex=0><code>from airflow.plugins_manager import AirflowPlugin
from airflow.models.baseoperator import BaseOperatorLink
from airflow.providers.cncf.kubernetes.operators.kubernetes_pod import (
    KubernetesPodOperator,
)

class MyLink(BaseOperatorLink):
    name = &#34;Kubernetes docs&#34;
    operators = [KubernetesPodOperator]
    def get_link(self, operator, *, ti_key=None):
        return &#34;https://kubernetes.io/&#34;

class MyPlugins(AirflowPlugin):
    name = &#34;my_plugins_poyo&#34;
    operator_extra_links = [
        MyLink(),
    ]
</code></pre><p>ä¸Šè¨˜ã®å ´åˆã€<code>Kubernetes docs</code>ã¨ã„ã†ãƒœã‚¿ãƒ³Linkã‚’ä½œæˆã—ã¦ãŠã‚Šã€ãƒœã‚¿ãƒ³Linkã‚’Clickã™ã‚‹ã¨<code>https://kubernetes.io/</code>ã¸é·ç§»ã™ã‚‹ã€‚ã¾ãŸã“ã®Linkã¯<code>KubernetesPodOperator</code>ã‚’ä½¿ç”¨ã—ãŸTaskã«ã—ã‹åæ˜ ã•ã‚Œãªã„ã“ã¨ã‚’æ„å›³ã¨ã—ã¦ã„ã‚‹ã€‚</p><h4 id=ä½œæˆã‚’åæ˜ ã•ã›ã‚‹-6>ä½œæˆã‚’åæ˜ ã•ã›ã‚‹ã€‚<a hidden class=anchor aria-hidden=true href=#ä½œæˆã‚’åæ˜ ã•ã›ã‚‹-6>#</a></h4><p>webserverã®å†èµ·å‹•ãŒå¿…è¦ã€‚</p><h4 id=ä½œæˆã—ãŸlinkã‚’ç¢ºèªã—ã¦ã¿ã‚‹-1>ä½œæˆã—ãŸLinkã‚’ç¢ºèªã—ã¦ã¿ã‚‹ã€‚<a hidden class=anchor aria-hidden=true href=#ä½œæˆã—ãŸlinkã‚’ç¢ºèªã—ã¦ã¿ã‚‹-1>#</a></h4><p>KubernetesPodOperatorã®ã‚ã‚‹DAGã‚’é–‹ã„ã¦ç¢ºèªã—ã¦ã¿ã‚‹ã€‚</p><ul><li>KubernetesPodOperatorã®Taskã«æœŸå¾…é€šã‚Šã®ãƒœã‚¿ãƒ³LinkãŒä½œã‚‰ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã‚‹ã€‚ãƒœã‚¿ãƒ³Linkã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨<code>https://kubernetes.io/</code>ã¸é·ç§»ã™ã‚‹ã€‚</li></ul><p><img loading=lazy src=https://storage.googleapis.com/zenn-user-upload/2888bb451e42-20230105.png alt></p><ul><li>PythonOperatorã®Taskã«ã¯ãƒœã‚¿ãƒ³LinkãŒä½œã‚‰ã‚Œã¦ã„ãªã„ã€‚</li></ul><p><img loading=lazy src=https://storage.googleapis.com/zenn-user-upload/5b4d15b5bba1-20230105.png alt></p><hr><h3 id=8timetablesã‚’ä½¿ç”¨ã—ã¦cronã§ã¯è¡¨ç¾ã§ããªã„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½œæˆã™ã‚‹>8.timetablesã‚’ä½¿ç”¨ã—ã¦CRONã§ã¯è¡¨ç¾ã§ããªã„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½œæˆã™ã‚‹<a hidden class=anchor aria-hidden=true href=#8timetablesã‚’ä½¿ç”¨ã—ã¦cronã§ã¯è¡¨ç¾ã§ããªã„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½œæˆã™ã‚‹>#</a></h3><p>å€‹äººçš„ãªæœ¬é¡Œã ã£ãŸã®ã§å°‘ã—ä»–ã‚ˆã‚Šã‚‚ä¸å¯§ã«æ›¸ãã€‚</p><h4 id=timetableã¨ã¯>Timetableã¨ã¯<a hidden class=anchor aria-hidden=true href=#timetableã¨ã¯>#</a></h4><p>Airflowã®DAGå†…ã§ã®ã€ŒCronã§è¡¨ã™ã“ã¨ãŒã§ããªã„ã‚ˆã†ãªã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ã‚’æ±ºã‚ã‚‹ãŸã‚ã®TimeTableã€‚DAGã«æ¸¡ã™<code>timetable</code>å¼•æ•°ã§æŒ‡å®šã§ãã‚‹ã€‚</p><ul><li>ã€ŒCronã§è¡¨ã™ã“ã¨ãŒã§ããªã„ã‚ˆã†ãªã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ã¨ã¯<ul><li>ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã€‚</li><li>å®Ÿè¡Œé–“éš”ãŒä¸è¦å‰‡<ul><li>2022.12.31 10:00/2023.01.03 10:00ã®ã¿å®Ÿè¡Œã™ã‚‹ãªã©</li></ul></li><li>æ¯æ—¥ç•°ãªã‚‹æ™‚é–“ã«å®Ÿè¡Œã™ã‚‹<ul><li>æ°´æ›œæ—¥ã¯10:00ã€æœ¨æ›œæ—¥ã¯03:00ã«å®Ÿè¡Œã™ã‚‹ãªã©</li></ul></li><li>ã‚°ãƒ¬ã‚´ãƒªã‚ªæš¦ã«å¾“ã‚ãªã„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</li></ul></li><li>æ¨™æº–ã§provideã•ã‚Œã¦ã„ã‚‹TimeTable<ul><li>EventsTimetable</li><li>CronTriggerTimetable</li></ul></li></ul><p>è©³ç´°ï¼š<a href=https://airflow.apache.org/docs/apache-airflow/stable/concepts/timetable.html>https://airflow.apache.org/docs/apache-airflow/stable/concepts/timetable.html</a></p><h4 id=ç‹¬è‡ªã®timetableä½œæˆæ–¹æ³•ã«ã¤ã„ã¦>ç‹¬è‡ªã®Timetableä½œæˆæ–¹æ³•ã«ã¤ã„ã¦<a hidden class=anchor aria-hidden=true href=#ç‹¬è‡ªã®timetableä½œæˆæ–¹æ³•ã«ã¤ã„ã¦>#</a></h4><p>Airflow2.2ã‹ã‚‰ç‹¬è‡ªã®TimeTableã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚<a href=https://github.com/apache/airflow/blob/0be5c90639dcaa9c6542434160f1f1caf51202a0/airflow/timetables/base.py#L108>airflow.timetables.base.Timetable</a>ã‚’æ‹¡å¼µã™ã‚Œã°è‰¯ã„ã®ã ãŒã€ä»¥ä¸‹ã®é–¢æ•°ã‚’å«ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚</p><table><thead><tr><th>é–¢æ•°å</th><th>about</th></tr></thead><tbody><tr><td>next_dagrun_info</td><td>ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œæ™‚ã®ãƒ‡ãƒ¼ã‚¿é–“éš”ã‚’è¿”ã™</td></tr><tr><td>infer_manual_data_interval</td><td>æ‰‹å‹•å®Ÿè¡Œæ™‚ã®ãƒ‡ãƒ¼ã‚¿é–“éš”ã§è¿”ã™</td></tr></tbody></table><h4 id=ç‹¬è‡ªã®timetableã«æŒ‡å®šã™ã‚‹é–¢æ•°ã‚’ä½œæˆã™ã‚‹>ç‹¬è‡ªã®Timetableã«æŒ‡å®šã™ã‚‹é–¢æ•°ã‚’ä½œæˆã™ã‚‹ã€‚<a hidden class=anchor aria-hidden=true href=#ç‹¬è‡ªã®timetableã«æŒ‡å®šã™ã‚‹é–¢æ•°ã‚’ä½œæˆã™ã‚‹>#</a></h4><p>ä»Šå›ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªä»•æ§˜ã®TimeTableã‚’ä½œã£ã¦ã¿ã¾ã™ã€‚</p><ul><li>1æ—¥ã«2å›,06:00(â‘ )ã¨16:30(â‘¡)ã«ã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œã™ã‚‹ã€‚å®Ÿè¡Œæ™‚ã«å–å¾—ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã®é–“éš”ã¯ä»¥ä¸‹ã€‚<ul><li>06:00(â‘ )å®Ÿè¡Œæ™‚ãƒ»ãƒ»ãƒ»å‰æ—¥ã®16:30~å½“æ—¥ã®06:00</li><li>16:30(â‘¡)å®Ÿè¡Œæ™‚ãƒ»ãƒ»ãƒ»å½“æ—¥ã®06:00~å½“æ—¥ã®16:30</li></ul></li></ul><h5 id=next_dagrun_infoé–¢æ•°>next_dagrun_infoé–¢æ•°<a hidden class=anchor aria-hidden=true href=#next_dagrun_infoé–¢æ•°>#</a></h5><ul><li>ãƒ‡ãƒ¼ã‚¿ã®é–“éš”ã‚’DagRunInfo(<code>run_after:DateTime</code>, <code>data_interval:DataInterval</code>)ã§è¿”ã™</li><li>parameterã«å…¥ã£ã¦ãã‚‹<code>restriction:TimeRestriction</code>ã¨ã¯DAGã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ãã‚‹æœŸé–“ã«é–¢ã™ã‚‹åˆ¶é™(<code>earliest:DateTime</code>,<code>latest:DateTime</code>,<code>catchup:bool</code>)ã‚’æŒã¤ã‚¯ãƒ©ã‚¹ã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>next_dagrun_info</span>(
</span></span><span style=display:flex><span>    self,
</span></span><span style=display:flex><span>    <span style=color:#f92672>*</span>,
</span></span><span style=display:flex><span>    last_automated_data_interval: Optional[DataInterval],
</span></span><span style=display:flex><span>    restriction: TimeRestriction,
</span></span><span style=display:flex><span>) <span style=color:#f92672>-&gt;</span> Optional[DagRunInfo]:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> last_automated_data_interval <span style=color:#f92672>is</span> <span style=color:#f92672>not</span> <span style=color:#66d9ef>None</span>:  <span style=color:#75715e># a</span>
</span></span><span style=display:flex><span>        last_start <span style=color:#f92672>=</span> last_automated_data_interval<span style=color:#f92672>.</span>start
</span></span><span style=display:flex><span>        delta <span style=color:#f92672>=</span> timedelta(days<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> last_start<span style=color:#f92672>.</span>hour <span style=color:#f92672>==</span> <span style=color:#ae81ff>6</span>: <span style=color:#75715e># b</span>
</span></span><span style=display:flex><span>            next_start <span style=color:#f92672>=</span> last_start<span style=color:#f92672>.</span>set(hour<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span>, minute<span style=color:#f92672>=</span><span style=color:#ae81ff>30</span>)<span style=color:#f92672>.</span>replace(tzinfo<span style=color:#f92672>=</span>UTC)
</span></span><span style=display:flex><span>            next_end <span style=color:#f92672>=</span> (last_start<span style=color:#f92672>+</span>delta)<span style=color:#f92672>.</span>replace(tzinfo<span style=color:#f92672>=</span>UTC)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>: <span style=color:#75715e># c</span>
</span></span><span style=display:flex><span>            next_start <span style=color:#f92672>=</span> (last_start<span style=color:#f92672>+</span>delta)<span style=color:#f92672>.</span>set(hour<span style=color:#f92672>=</span><span style=color:#ae81ff>6</span>, minute<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>)<span style=color:#f92672>.</span>replace(tzinfo<span style=color:#f92672>=</span>UTC)
</span></span><span style=display:flex><span>            next_end <span style=color:#f92672>=</span> (last_start<span style=color:#f92672>+</span>delta)<span style=color:#f92672>.</span>replace(tzinfo<span style=color:#f92672>=</span>UTC)
</span></span><span style=display:flex><span>ã€€ã€€<span style=color:#66d9ef>else</span>:  <span style=color:#75715e># d</span>
</span></span><span style=display:flex><span>        next_start <span style=color:#f92672>=</span> restriction<span style=color:#f92672>.</span>earliest
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> next_start <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:  
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> restriction<span style=color:#f92672>.</span>catchup:
</span></span><span style=display:flex><span>            next_start <span style=color:#f92672>=</span> max(next_start, DateTime<span style=color:#f92672>.</span>combine(Date<span style=color:#f92672>.</span>today(), Time<span style=color:#f92672>.</span>min)<span style=color:#f92672>.</span>replace(tzinfo<span style=color:#f92672>=</span>UTC))
</span></span><span style=display:flex><span>        next_start <span style=color:#f92672>=</span> next_start<span style=color:#f92672>.</span>set(hour<span style=color:#f92672>=</span><span style=color:#ae81ff>6</span>, minute<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>)<span style=color:#f92672>.</span>replace(tzinfo<span style=color:#f92672>=</span>UTC)
</span></span><span style=display:flex><span>        next_end <span style=color:#f92672>=</span> next_start<span style=color:#f92672>.</span>set(hour<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span>, minute<span style=color:#f92672>=</span><span style=color:#ae81ff>30</span>)<span style=color:#f92672>.</span>replace(tzinfo<span style=color:#f92672>=</span>UTC)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> restriction<span style=color:#f92672>.</span>latest <span style=color:#f92672>is</span> <span style=color:#f92672>not</span> <span style=color:#66d9ef>None</span> <span style=color:#f92672>and</span> next_start <span style=color:#f92672>&gt;</span> restriction<span style=color:#f92672>.</span>latest: <span style=color:#75715e># e</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>None</span> 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> DagRunInfo<span style=color:#f92672>.</span>interval(start<span style=color:#f92672>=</span>next_start, end<span style=color:#f92672>=</span>next_end)
</span></span></code></pre></div><p>é•·ã„è¡Œã«ãªã‚Šã¾ã—ãŸãŒè£œè¶³ã™ã‚‹ã¨ä»¥ä¸‹</p><ul><li>åˆå›å®Ÿè¡Œã§ã¯ãªã„å ´åˆ(a)<ul><li>å‰å›å®Ÿè¡Œã®ãƒ‡ãƒ¼ã‚¿é–“éš”ã®StartãŒ06:00ã®å ´åˆ(b)<ul><li>ä»Šå›ã®å®Ÿè¡Œã¯â‘ ã«è©²å½“ã™ã‚‹</li><li>next_startã¯å‰å›ã®å½“æ—¥ã®16:30</li><li>next_endã¯å‰å›ã®ç¿Œæ—¥ã®06:00</li></ul></li><li>å‰å›å®Ÿè¡Œã®ãƒ‡ãƒ¼ã‚¿é–“éš”ã®StartãŒ16:30ã®å ´åˆ(c)<ul><li>ä»Šå›ã®å®Ÿè¡Œã¯â‘¡ã«è©²å½“ã™ã‚‹</li><li>next_startã¯å‰å›ã®ç¿Œæ—¥ã®06:00</li><li>next_endã¯å‰å›ã®ç¿Œæ—¥ã®16:30</li></ul></li></ul></li><li>åˆå›å®Ÿè¡Œã®å ´åˆ(d)<ul><li>DAGã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ãã‚‹æœŸé–“ã®ã†ã¡ã®æœ€æ—©ã„æ—¥ã‚’å®Ÿè¡Œæ—¥(next_start)ã¨ã—ã¦ï¼ˆcatchup=Falseã®å ´åˆã€ç¾åœ¨ã®æ—¥ä»˜ã‚’å®Ÿè¡Œæ—¥(next_start)ã¨ã™ã‚‹ï¼‰<ul><li>next_startã¯å®Ÿè¡Œæ—¥ã®06:00</li><li>next_endã¯å®Ÿè¡Œæ—¥ã®16:30</li></ul></li></ul></li><li>ã¾ãŸã“ã®æ™‚DAGã®çµ‚äº†æ—¥(restriction.latest)ãŒã‚ã‚‹å ´åˆã€ãã®æ—¥ã‚’è¶Šã—ãŸnext_endã‚’å®Ÿè¡Œã—ãªã„ã“ã¨ã‚’æœŸå¾…ã—ã¦ã„ã‚‹ã€‚(e)</li></ul><h4 id=infer_manual_data_intervalé–¢æ•°>infer_manual_data_intervalé–¢æ•°<a hidden class=anchor aria-hidden=true href=#infer_manual_data_intervalé–¢æ•°>#</a></h4><ul><li>ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œæ™‚ã®ãƒ‡ãƒ¼ã‚¿ã®é–“éš”ã‚’DataInterval(<code>start: DateTime</code>, <code>end:Datetime</code>)ã§è¿”ã™ã€‚</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>infer_manual_data_interval</span>(self, run_after: DateTime) <span style=color:#f92672>-&gt;</span> DataInterval:
</span></span><span style=display:flex><span>    delta <span style=color:#f92672>=</span> timedelta(days<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>    <span style=color:#75715e># a</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> run_after <span style=color:#f92672>&gt;=</span> run_after<span style=color:#f92672>.</span>set(hour<span style=color:#f92672>=</span><span style=color:#ae81ff>6</span>, minute<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>) <span style=color:#f92672>and</span> run_after <span style=color:#f92672>&lt;=</span> run_after<span style=color:#f92672>.</span>set(hour<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span>, minute<span style=color:#f92672>=</span><span style=color:#ae81ff>30</span>):
</span></span><span style=display:flex><span>        start <span style=color:#f92672>=</span> (run_after<span style=color:#f92672>-</span>delta)<span style=color:#f92672>.</span>set(hour<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span>, minute<span style=color:#f92672>=</span><span style=color:#ae81ff>30</span>, second<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>)<span style=color:#f92672>.</span>replace(tzinfo<span style=color:#f92672>=</span>UTC) 
</span></span><span style=display:flex><span>        end <span style=color:#f92672>=</span> run_after<span style=color:#f92672>.</span>set(hour<span style=color:#f92672>=</span><span style=color:#ae81ff>6</span>, minute<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>, second<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>)<span style=color:#f92672>.</span>replace(tzinfo<span style=color:#f92672>=</span>UTC) 
</span></span><span style=display:flex><span>    <span style=color:#75715e># b</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> run_after <span style=color:#f92672>&gt;=</span> run_after<span style=color:#f92672>.</span>set(hour<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span>, minute<span style=color:#f92672>=</span><span style=color:#ae81ff>30</span>) <span style=color:#f92672>and</span> run_after<span style=color:#f92672>.</span>hour <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>23</span>:
</span></span><span style=display:flex><span>        start <span style=color:#f92672>=</span> run_after<span style=color:#f92672>.</span>set(hour<span style=color:#f92672>=</span><span style=color:#ae81ff>6</span>, minute<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>, second<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>)<span style=color:#f92672>.</span>replace(tzinfo<span style=color:#f92672>=</span>UTC)
</span></span><span style=display:flex><span>        end <span style=color:#f92672>=</span> run_after<span style=color:#f92672>.</span>set(hour<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span>, minute<span style=color:#f92672>=</span><span style=color:#ae81ff>30</span>, second<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>)<span style=color:#f92672>.</span>replace(tzinfo<span style=color:#f92672>=</span>UTC)
</span></span><span style=display:flex><span>    <span style=color:#75715e># c</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        start <span style=color:#f92672>=</span> (run_after<span style=color:#f92672>-</span>delta)<span style=color:#f92672>.</span>set(hour<span style=color:#f92672>=</span><span style=color:#ae81ff>6</span>, minute<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>)<span style=color:#f92672>.</span>replace(tzinfo<span style=color:#f92672>=</span>UTC)
</span></span><span style=display:flex><span>        end <span style=color:#f92672>=</span> (run_after<span style=color:#f92672>-</span>delta)<span style=color:#f92672>.</span>set(hour<span style=color:#f92672>=</span><span style=color:#ae81ff>16</span>, minute<span style=color:#f92672>=</span><span style=color:#ae81ff>30</span>)<span style=color:#f92672>.</span>replace(tzinfo<span style=color:#f92672>=</span>UTC)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> DataInterval(start<span style=color:#f92672>=</span>start, end<span style=color:#f92672>=</span>end)
</span></span></code></pre></div><p>è£œè¶³ã™ã‚‹ã¨</p><ul><li>ç¾åœ¨æ™‚åˆ»ãŒ06:00~16:30ã®é–“(a)<ul><li>â‘ ã®å®Ÿè¡Œã¨ã•ã‚Œã‚‹ã€‚</li><li>startã¯å‰æ—¥ã®16:30ã€endã¯å½“æ—¥ã®06:00</li></ul></li><li>ç¾åœ¨ã®æ™‚åˆ»ãŒ16:30~23:00ã®é–“(b)<ul><li>â‘¡ã®å®Ÿè¡Œã¨ã•ã‚Œã‚‹ã€‚</li><li>startã¯å½“æ—¥ã®06:00ã€endã¯å½“æ—¥ã®16:30</li></ul></li><li>ãã‚Œä»¥å¤–ã€æ·±å¤œã®00:00~05:59ã®é–“(c)<ul><li>â‘¡ã®å®Ÿè¡Œã¨ã•ã‚Œã‚‹ã€‚</li><li>startã¯å‰æ—¥ã®06:00ã€endã¯å‰æ—¥ã®16:30</li></ul></li></ul><h4 id=plugins_folderé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«-7>plugins_folderé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«<a hidden class=anchor aria-hidden=true href=#plugins_folderé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«-7>#</a></h4><ul><li>ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ </li></ul><pre tabindex=0><code>â”œâ”€â”€ __init__.py
â””â”€â”€ timetables
    â”œâ”€â”€ __init__.py
    â””â”€â”€ airflow_timetable_template.py
</code></pre><ul><li><code>__init__.py</code></li></ul><pre tabindex=0><code>from airflow.plugins_manager import AirflowPlugin
import timetables

class MyPlugins(AirflowPlugin):
    name = &#34;my_plugins_poyo&#34;
    timetables = [timetables.MyTimeTable]
</code></pre><ul><li><code>timetables/__init__.py</code></li></ul><pre tabindex=0><code>from timetables.airflow_timetable_template import MyTimeTable

__all__ = [&#39;MyTimeTable&#39;]
</code></pre><ul><li><code>timetables/airflow_timetable_template.py</code>
ä¸Šè¨˜ã§æ›¸ã„ãŸé–¢æ•°ã‚’ãã®ã¾ã¾ç§»æ¤ã—ã¦ã„ãã¾ã™ã€‚TimeTableåã¯<code>MyTimeTable</code></li></ul><pre tabindex=0><code>from datetime import timedelta
from typing import Optional
from pendulum import Date, DateTime, Time, timezone

from airflow.plugins_manager import AirflowPlugin
from airflow.timetables.base import DagRunInfo, DataInterval, TimeRestriction, Timetable

UTC = timezone(&#34;UTC&#34;)

class MyTimeTable(Timetable):

    def infer_manual_data_interval(self, run_after: DateTime) -&gt; DataInterval:
        ãƒ»ãƒ»ãƒ»

    def next_dagrun_info(
        self,
        *,
        last_automated_data_interval: Optional[DataInterval],
        restriction: TimeRestriction,
    ) -&gt; Optional[DagRunInfo]:
        ãƒ»ãƒ»ãƒ»
</code></pre><h4 id=ä½œæˆã‚’åæ˜ ã•ã›ã‚‹-7>ä½œæˆã‚’åæ˜ ã•ã›ã‚‹ã€‚<a hidden class=anchor aria-hidden=true href=#ä½œæˆã‚’åæ˜ ã•ã›ã‚‹-7>#</a></h4><p>webserverã¨schedulerã®å†èµ·å‹•ãŒå¿…è¦ã€‚(TimeTableã¯schedulerã‚‚èª­ã¿è¾¼ã‚€å¿…è¦ãŒã‚ã‚‹ãŸã‚schedulerã‚‚å†èµ·å‹•ã—ã¾ã™ã€‚å†èµ·å‹•ã—ãªã„ã¨<code>TimetableNotRegistered</code>ErrorãŒå‡ºã¾ã™ã€‚)</p><h4 id=ä½œæˆã—ãŸtimetableã‚’è©¦ã—ã¦ã¿ã‚‹>ä½œæˆã—ãŸTimeTableã‚’è©¦ã—ã¦ã¿ã‚‹ã€‚<a hidden class=anchor aria-hidden=true href=#ä½œæˆã—ãŸtimetableã‚’è©¦ã—ã¦ã¿ã‚‹>#</a></h4><ul><li>dagã®ãƒ•ã‚¡ã‚¤ãƒ«
é©å½“ãªDAGã®<code>timetable</code>å¼•æ•°ã«ä½œæˆã—ãŸ<code>MyTimeTable:TimeTable</code>ã‚’æ¸¡ã™ã€‚importErrorãŒå‡ºã¦ãªã‘ã‚Œã°æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹ã¯ãšã€</li></ul><pre tabindex=0><code>from timetables.airflow_timetable_template import MyTimeTable


@dag(start_date=days_ago(2), timetable=MyTimeTable())
...
</code></pre><ul><li>UIã‹ã‚‰ä½œæˆã—ãŸDAGã®ç¢ºèª<ul><li>ScheduleãŒ<code>MyTimeTable</code>ã«ãªã£ã¦ã„ã‚‹</li><li>ç¾åœ¨æ™‚åˆ»ãŒ<code>01/05.14:08</code>ã®å ´åˆ<ul><li>æ¬¡ã®å®Ÿè¡Œã¯<code>01/05.16:30</code></li><li>æ¬¡ã®æ¬¡ã®å®Ÿè¡Œã¯<code>01/06.06:00</code>ã€‚ãã®æ™‚ã®ãƒ‡ãƒ¼ã‚¿é–“éš”ã¯<code>01/05.16:30~01/06.06:00</code>
<img loading=lazy src=https://storage.googleapis.com/zenn-user-upload/d0837ec8e048-20230105.png alt></li></ul></li></ul></li></ul><hr><h2 id=çµ‚ã‚ã‚Š>çµ‚ã‚ã‚Š<a hidden class=anchor aria-hidden=true href=#çµ‚ã‚ã‚Š>#</a></h2><p>ä»¥ä¸ŠAirflowã®Pluginã«ã¤ã„ã¦è¦‹ã¦ã„ãã¾ã—ãŸã€‚TimeTableã«ã¤ã„ã¦ã¯ã€Airflowã®Scheduleã«ã¤ã„ã¦å†åº¦ç†è§£ã™ã‚‹æ©Ÿä¼šã«ãªã£ã¦ã‚ˆã‹ã£ãŸã§ã™ã€‚ã¾ãŸæ™‚é–“ãŒã‚ã‚‹ã¨ãã«listenerã‚„executorã®ã‚«ã‚¹ã‚¿ãƒ ã‚‚è©¦ã—ã¦ã¿ãŸã„ã§ã™ã€‚</p><h2 id=å‚è€ƒ>å‚è€ƒ<a hidden class=anchor aria-hidden=true href=#å‚è€ƒ>#</a></h2><ul><li><a href=https://docs.astronomer.io/learn/scheduling-in-airflow#timetables>https://docs.astronomer.io/learn/scheduling-in-airflow#timetables</a></li><li><a href=https://docs.astronomer.io/learn/using-airflow-plugins>https://docs.astronomer.io/learn/using-airflow-plugins</a></li><li><a href=https://airflow.apache.org/docs/apache-airflow/stable/plugins.html>https://airflow.apache.org/docs/apache-airflow/stable/plugins.html</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://467tn.com/tags/airflow/>Airflow</a></li><li><a href=https://467tn.com/tags/python/>Python</a></li></ul><nav class=paginav><a class=prev href=https://467tn.com/post/content9/><span class=title>Â« Prev</span><br><span>Hadoopå‘¨è¾ºã®è¨­å®šãƒ¡ãƒ¢</span></a>
<a class=next href=https://467tn.com/post/content7/><span class=title>Next Â»</span><br><span>Airflowã®TaskFlowAPIã«ã¤ã„ã¦</span></a></nav><br><hr><br><h3>Shares</h3><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Airflowã®Pluginsã«ã¤ã„ã¦ on twitter" href="https://twitter.com/intent/tweet/?text=Airflow%e3%81%aePlugins%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6&url=https%3a%2f%2f467tn.com%2fpost%2fcontent8%2f&hashtags=Airflow%2cPython"><svg viewBox="0 0 512 512" height="30" width="30"><defs><style>.fill{fill:#3aa6b9}</style></defs><path class="fill" d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a></div></footer><h3>Comments</h3><script src=https://giscus.app/client.js data-repo=srn221B/blog data-repo-id=R_kgDOIBf-Xg data-category=Comments data-category-id=DIC_kwDOIBf-Xs4CTe7o data-mapping=pathname data-reactions-enabled=1 data-emit-metadata=0 data-theme=https://giscus.app/themes/custom_example.css crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2024 <a href=https://467tn.com>-1.9517320122461623</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerHTML="copy";function s(){e.innerHTML="copied!",setTimeout(()=>{e.innerHTML="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>