<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ワークフロー管理についてメモ | -1.9517320122461623</title><meta name=keywords content="Workflow"><meta name=description content="備忘録"><meta name=author content="Me"><link rel=canonical href=https://canonical.url/to/page><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.447f4924d3ebf89bcf25c7e77c905cb2ee6ea803dacb2c3621646ef4f50d1f86.css integrity="sha256-RH9JJNPr+JvPJcfnfJBcsu5uqAPayyw2IWRu9PUNH4Y=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://github.com/srn221B/srn221B.github.io/assets/60976262/00ebf8b5-eceb-4f87-8e70-df54f431a9b8><link rel=icon type=image/png sizes=16x16 href=https://github.com/srn221B/srn221B.github.io/assets/60976262/00ebf8b5-eceb-4f87-8e70-df54f431a9b8><link rel=icon type=image/png sizes=32x32 href=https://github.com/srn221B/srn221B.github.io/assets/60976262/00ebf8b5-eceb-4f87-8e70-df54f431a9b8><link rel=apple-touch-icon href=https://user-images.githubusercontent.com/60976262/190914441-404cb19b-540f-4178-a89d-8f89ab1e187c.png><link rel=mask-icon href=https://user-images.githubusercontent.com/60976262/190914441-404cb19b-540f-4178-a89d-8f89ab1e187c.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="ワークフロー管理についてメモ"><meta property="og:description" content="備忘録"><meta property="og:type" content="article"><meta property="og:url" content="https://467tn.com/post/content14/"><meta property="og:image" content="https://user-images.githubusercontent.com/60976262/191047722-dd7ed9ad-6e00-4b50-8073-24ae9602b8d6.png"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-01-08T11:30:03+00:00"><meta property="article:modified_time" content="2024-01-08T11:30:03+00:00"><meta property="og:site_name" content="467"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://user-images.githubusercontent.com/60976262/191047722-dd7ed9ad-6e00-4b50-8073-24ae9602b8d6.png"><meta name=twitter:title content="ワークフロー管理についてメモ"><meta name=twitter:description content="備忘録"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://467tn.com/post/"},{"@type":"ListItem","position":3,"name":"ワークフロー管理についてメモ","item":"https://467tn.com/post/content14/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ワークフロー管理についてメモ","name":"ワークフロー管理についてメモ","description":"備忘録","keywords":["Workflow"],"articleBody":"WEB+DB PRESS plusの「ビッグデータを支える技術」という本の180ページから書かれているワークフロー管理について ワークフロー周りを開発している身としては忘れないようにしたい内容だと思ったので、備忘録として雑に残します。\nワークフロー管理 ワークフロー管理ツール 主な役割としては「定期的にタスクを実行すること」と「異常を検知してその解決を手助けすること」。 例えば以下のようなものがある\n   名称 種類 開発元     Airflow スクリプト型 Airbnb   Azkaban 宣言型 Linkedin   Digdag 宣言型 TreasureData   Oozie 宣言型 The Apache Software Foundation   Luigi スクリプト型 Spotify   Prefect スクリプト型 Prefect Technologies   Metaflow スクリプト型 Netflix   Dagster スクリプト型 Dagster    基本機能とビッグデータで求められる機能  タスクを定期的なスケジュールで実行し、その結果を通知する タスク間の依存関係を定めて、決められた順にもれなく実行する タスクの実行結果を保持し、エラー発生時には再実行できるようにする  宣言型とスクリプト型  宣言型のメリット  最小限の記述でタスクを定義できる   スクリプト型のメリット  柔軟性    ETLのプロセスにはスクリプト型のツール、SQLの実行には宣言型のツールをなどと使い分けるのも一つの方法。\nエラーからのリカバリ方法を先に考える  あらかじめ予期せぬエラーが発生する可能性を考慮して、エラー発生時の対処方法を決めておくことが重要 ワークフロー管理ではタスクの実行順序を決めると同時にエラーからどのように回復するかというプランを定める 何か問題が起きても速やかに回復できるようなエラーに強いワークフローを構築し、毎日のデータ処理を安定して実行できるように勤める  リカバリとフローの再実行  エラーには無数の可能性があるため、ワークフロー管理では基本的にはエラーから自動回復できるものとは考えない 代わりに手作業によるリカバリー前提としてタスクを設計する 失敗したタスクは全て記録してそれを後から再実行できるようにする  リトライ  何度も発生するエラーについてはなるべくリカバリを自動化する  バックフィル  パラメータに含まれる日時を順に変えながら一定期間のフローを連続して実行する仕組みをバックフィルという 過去に遡って実行したい場合などに使う  冪等な操作としてタスクを実行する  リカバリーの前提として忘れてはならないのが、再実行の安全性 タスクは前提として「最後まで成功」するか「失敗しても何も残らない」のどちらかであるべき  アトミック操作  各タスクがシステムに変更を加えるのを一度きりにする  冪等な操作  タスクに与えられたパラメータをうまく使って固有の名前を生成し、何度実行しても常に置き換えが行われるように設計する  冪等な追記  一般にテーブルから一部のデータだけを削除するのは非効率であり、予期せぬ劣化を招く可能性がある テーブルパーティショニングの考え方を導入し、パーティション単位で置き換えを行うようにする DBの構成上パーティショニングが不可能な場合はアトミックな追記を検討する  アトミックな追記  一度中間テーブルを作成してから、最後に一度だけ目的のテーブルに追記するのが安全 実行途中で問題が起きても、中途半端にデータが書き込まれることがなくなる  ワークフロー全体を冪等にする  全てのフローが冪等になるようになっていれば、安心してワークフローを再実行できる  タスクキュー  リソースの消費量をコントロールする 全てのタスクは一旦キューに格納され、一定数のワーカープロセスがそれらを順に取り出すことで並列化が実現される  ボトルネックの解消 よく発生する問題\n CPU使用率100% メモリ不足 ディスク溢れ ディスクI/Oの限界 ネットワーク帯域の限界 通信エラーやタイムアウト  タスク数の適正化  限られた計算リソースを無駄なく活用できるように各タスクが適度な大きさになるように調整する  ","wordCount":"91","inLanguage":"en","image":"https://user-images.githubusercontent.com/60976262/191047722-dd7ed9ad-6e00-4b50-8073-24ae9602b8d6.png","datePublished":"2024-01-08T11:30:03Z","dateModified":"2024-01-08T11:30:03Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://467tn.com/post/content14/"},"publisher":{"@type":"Organization","name":"-1.9517320122461623","logo":{"@type":"ImageObject","url":"https://github.com/srn221B/srn221B.github.io/assets/60976262/00ebf8b5-eceb-4f87-8e70-df54f431a9b8"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://467tn.com accesskey=h title="  (Alt + H)"><img src=https://467tn.com/home2.png alt aria-label=logo height=35></a><div class=logo-switches></div></div><ul id=menu><li><a href=https://467tn.com/ title=whoami><span>whoami</span></a></li><li><a href=https://467tn.com/archives/ title=archive><span>archive</span></a></li><li><a href=https://467tn.com/tags/ title=tags><span>tags</span></a></li><li><a href=https://filmarks.com/users/467 title=🎥filmarks><span>🎥filmarks</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://booklog.jp/users/467 title=📚booklog><span>📚booklog</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://zenn.dev/467 title=🗒zenn><span>🗒zenn</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://s6n.hatenablog.com/ title=🛫travels><span>🛫travels</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://467tn.com>Home</a>&nbsp;»&nbsp;<a href=https://467tn.com/post/>Posts</a></div><h1 class=post-title style=color:#164b60>ワークフロー管理についてメモ</h1><div class=post-description>備忘録</div><div class=post-meta><span title="2024-01-08 11:30:03 +0000 +0000">January 8, 2024</span>&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/srn221B/blog/tree/master/content/post/content14.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#ワークフロー管理>ワークフロー管理</a><ul><li><a href=#ワークフロー管理ツール>ワークフロー管理ツール</a></li><li><a href=#基本機能とビッグデータで求められる機能>基本機能とビッグデータで求められる機能</a></li><li><a href=#宣言型とスクリプト型>宣言型とスクリプト型</a></li></ul></li><li><a href=#エラーからのリカバリ方法を先に考える>エラーからのリカバリ方法を先に考える</a><ul><li><a href=#リカバリとフローの再実行>リカバリとフローの再実行</a></li><li><a href=#リトライ>リトライ</a></li><li><a href=#バックフィル>バックフィル</a></li></ul></li><li><a href=#冪等な操作としてタスクを実行する>冪等な操作としてタスクを実行する</a><ul><li><a href=#アトミック操作>アトミック操作</a></li><li><a href=#冪等な操作>冪等な操作</a></li><li><a href=#冪等な追記>冪等な追記</a></li><li><a href=#アトミックな追記>アトミックな追記</a></li></ul></li><li><a href=#ワークフロー全体を冪等にする>ワークフロー全体を冪等にする</a></li><li><a href=#タスクキュー>タスクキュー</a><ul><li><a href=#ボトルネックの解消>ボトルネックの解消</a></li><li><a href=#タスク数の適正化>タスク数の適正化</a></li></ul></li></ul></nav></div></details></div><div class=post-content><p>WEB+DB PRESS plusの「ビッグデータを支える技術」という本の180ページから書かれているワークフロー管理について
ワークフロー周りを開発している身としては忘れないようにしたい内容だと思ったので、備忘録として雑に残します。</p><h2 id=ワークフロー管理>ワークフロー管理<a hidden class=anchor aria-hidden=true href=#ワークフロー管理>#</a></h2><h3 id=ワークフロー管理ツール>ワークフロー管理ツール<a hidden class=anchor aria-hidden=true href=#ワークフロー管理ツール>#</a></h3><p>主な役割としては「定期的にタスクを実行すること」と「異常を検知してその解決を手助けすること」。
例えば以下のようなものがある</p><table><thead><tr><th>名称</th><th>種類</th><th>開発元</th></tr></thead><tbody><tr><td>Airflow</td><td>スクリプト型</td><td>Airbnb</td></tr><tr><td>Azkaban</td><td>宣言型</td><td>Linkedin</td></tr><tr><td>Digdag</td><td>宣言型</td><td>TreasureData</td></tr><tr><td>Oozie</td><td>宣言型</td><td>The Apache Software Foundation</td></tr><tr><td>Luigi</td><td>スクリプト型</td><td>Spotify</td></tr><tr><td>Prefect</td><td>スクリプト型</td><td>Prefect Technologies</td></tr><tr><td>Metaflow</td><td>スクリプト型</td><td>Netflix</td></tr><tr><td>Dagster</td><td>スクリプト型</td><td>Dagster</td></tr></tbody></table><h3 id=基本機能とビッグデータで求められる機能>基本機能とビッグデータで求められる機能<a hidden class=anchor aria-hidden=true href=#基本機能とビッグデータで求められる機能>#</a></h3><ul><li>タスクを定期的なスケジュールで実行し、その結果を通知する</li><li>タスク間の依存関係を定めて、決められた順にもれなく実行する</li><li>タスクの実行結果を保持し、エラー発生時には再実行できるようにする</li></ul><h3 id=宣言型とスクリプト型>宣言型とスクリプト型<a hidden class=anchor aria-hidden=true href=#宣言型とスクリプト型>#</a></h3><ul><li>宣言型のメリット<ul><li>最小限の記述でタスクを定義できる</li></ul></li><li>スクリプト型のメリット<ul><li>柔軟性</li></ul></li></ul><p>ETLのプロセスにはスクリプト型のツール、SQLの実行には宣言型のツールをなどと使い分けるのも一つの方法。</p><h2 id=エラーからのリカバリ方法を先に考える>エラーからのリカバリ方法を先に考える<a hidden class=anchor aria-hidden=true href=#エラーからのリカバリ方法を先に考える>#</a></h2><ul><li>あらかじめ予期せぬエラーが発生する可能性を考慮して、エラー発生時の対処方法を決めておくことが重要</li><li>ワークフロー管理ではタスクの実行順序を決めると同時にエラーからどのように回復するかというプランを定める</li><li>何か問題が起きても速やかに回復できるようなエラーに強いワークフローを構築し、毎日のデータ処理を安定して実行できるように勤める</li></ul><h3 id=リカバリとフローの再実行>リカバリとフローの再実行<a hidden class=anchor aria-hidden=true href=#リカバリとフローの再実行>#</a></h3><ul><li>エラーには無数の可能性があるため、ワークフロー管理では基本的にはエラーから自動回復できるものとは考えない</li><li>代わりに手作業によるリカバリー前提としてタスクを設計する</li><li>失敗したタスクは全て記録してそれを後から再実行できるようにする</li></ul><h3 id=リトライ>リトライ<a hidden class=anchor aria-hidden=true href=#リトライ>#</a></h3><ul><li>何度も発生するエラーについてはなるべくリカバリを自動化する</li></ul><h3 id=バックフィル>バックフィル<a hidden class=anchor aria-hidden=true href=#バックフィル>#</a></h3><ul><li>パラメータに含まれる日時を順に変えながら一定期間のフローを連続して実行する仕組みをバックフィルという</li><li>過去に遡って実行したい場合などに使う</li></ul><h2 id=冪等な操作としてタスクを実行する>冪等な操作としてタスクを実行する<a hidden class=anchor aria-hidden=true href=#冪等な操作としてタスクを実行する>#</a></h2><ul><li>リカバリーの前提として忘れてはならないのが、再実行の安全性</li><li>タスクは前提として「最後まで成功」するか「失敗しても何も残らない」のどちらかであるべき</li></ul><h3 id=アトミック操作>アトミック操作<a hidden class=anchor aria-hidden=true href=#アトミック操作>#</a></h3><ul><li>各タスクがシステムに変更を加えるのを一度きりにする</li></ul><h3 id=冪等な操作>冪等な操作<a hidden class=anchor aria-hidden=true href=#冪等な操作>#</a></h3><ul><li>タスクに与えられたパラメータをうまく使って固有の名前を生成し、何度実行しても常に置き換えが行われるように設計する</li></ul><h3 id=冪等な追記>冪等な追記<a hidden class=anchor aria-hidden=true href=#冪等な追記>#</a></h3><ul><li>一般にテーブルから一部のデータだけを削除するのは非効率であり、予期せぬ劣化を招く可能性がある</li><li>テーブルパーティショニングの考え方を導入し、パーティション単位で置き換えを行うようにする</li><li>DBの構成上パーティショニングが不可能な場合はアトミックな追記を検討する</li></ul><h3 id=アトミックな追記>アトミックな追記<a hidden class=anchor aria-hidden=true href=#アトミックな追記>#</a></h3><ul><li>一度中間テーブルを作成してから、最後に一度だけ目的のテーブルに追記するのが安全</li><li>実行途中で問題が起きても、中途半端にデータが書き込まれることがなくなる</li></ul><h2 id=ワークフロー全体を冪等にする>ワークフロー全体を冪等にする<a hidden class=anchor aria-hidden=true href=#ワークフロー全体を冪等にする>#</a></h2><ul><li>全てのフローが冪等になるようになっていれば、安心してワークフローを再実行できる</li></ul><h2 id=タスクキュー>タスクキュー<a hidden class=anchor aria-hidden=true href=#タスクキュー>#</a></h2><ul><li>リソースの消費量をコントロールする</li><li>全てのタスクは一旦キューに格納され、一定数のワーカープロセスがそれらを順に取り出すことで並列化が実現される</li></ul><h3 id=ボトルネックの解消>ボトルネックの解消<a hidden class=anchor aria-hidden=true href=#ボトルネックの解消>#</a></h3><p>よく発生する問題</p><ul><li>CPU使用率100%</li><li>メモリ不足</li><li>ディスク溢れ</li><li>ディスクI/Oの限界</li><li>ネットワーク帯域の限界</li><li>通信エラーやタイムアウト</li></ul><h3 id=タスク数の適正化>タスク数の適正化<a hidden class=anchor aria-hidden=true href=#タスク数の適正化>#</a></h3><ul><li>限られた計算リソースを無駄なく活用できるように各タスクが適度な大きさになるように調整する</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://467tn.com/tags/workflow/>Workflow</a></li></ul><nav class=paginav><a class=next href=https://467tn.com/post/content13/><span class=title>Next »</span><br><span>Rayメモ</span></a></nav><br><hr><br><h3>Shares</h3><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share ワークフロー管理についてメモ on twitter" href="https://twitter.com/intent/tweet/?text=%e3%83%af%e3%83%bc%e3%82%af%e3%83%95%e3%83%ad%e3%83%bc%e7%ae%a1%e7%90%86%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6%e3%83%a1%e3%83%a2&url=https%3a%2f%2f467tn.com%2fpost%2fcontent14%2f&hashtags=Workflow"><svg viewBox="0 0 512 512" height="30" width="30"><defs><style>.fill{fill:#3aa6b9}</style></defs><path class="fill" d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a></div></footer><h3>Comments</h3><script src=https://giscus.app/client.js data-repo=srn221B/blog data-repo-id=R_kgDOIBf-Xg data-category=Comments data-category-id=DIC_kwDOIBf-Xs4CTe7o data-mapping=pathname data-reactions-enabled=1 data-emit-metadata=0 data-theme=https://giscus.app/themes/custom_example.css crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2024 <a href=https://467tn.com>-1.9517320122461623</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerHTML="copy";function s(){e.innerHTML="copied!",setTimeout(()=>{e.innerHTML="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>